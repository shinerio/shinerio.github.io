## 划词评论增加编辑与删除功能
date: 2026-02-14
## 新增博客 Markdown 源文件导出功能
date: 2026-02-14

本次更新为博客系统添加了完整的 Markdown 源文件导出功能，允许读者直接下载文章的原始 Markdown 文件。

### 主要功能
1. **文章详情页导出按钮**：在每篇文章标题旁添加下载图标，点击即可下载该文章的 Markdown 源文件
2. **文章列表页导出按钮**：在文章列表中每个标题旁也添加了导出按钮，方便批量收藏
3. **智能文件命名**：下载的文件名使用文章标题（如"Getting Started.md"），而非 URL slug
4. **源文件存储**：所有 Markdown 文件自动复制到 `dist/assets/markdown/` 目录

### 技术实现
- **后端（SiteGenerator.ts）**：
  - 新增 `copyMarkdownFiles()` 方法，在生成网站时自动复制所有已发布文章的 Markdown 源文件
  - 文件使用 slug 命名存储（URL 安全），通过 HTML5 `download` 属性指定用户友好的下载文件名
  - 草稿文章不会被复制，确保隐私性
  - 更新 `renderArticleListItem()` 和 `generateArticlePages()` 方法，在 HTML 中添加导出按钮

- **前端模板**：
  - `article.html`：在文章标题区域添加导出按钮和响应式布局
  - `articles-filters.js`：修复动态渲染文章列表时导出按钮丢失的问题

- **样式（style.css）**：
  - 新增 `.markdown-export-btn` 样式，包含悬停动画效果
  - 支持深色模式
  - 移动端优化：更大的触摸目标（36x36px）

### 用户体验优化
- 使用 Feather Icons 的下载图标，视觉清晰美观
- 鼠标悬停时按钮颜色变化并轻微上浮，提供即时反馈
- 点击事件阻止冒泡，避免误触文章链接
- 完整的无障碍支持（aria-label, title 属性）

### 修复的问题
- 修复了文章列表页在使用筛选、排序、分页功能后导出按钮消失的 Bug
- 该问题是因为 JavaScript 动态重建文章列表时未包含导出按钮 HTML

### 文件变更
- `src/core/SiteGenerator.ts`：后端逻辑实现
- `templates/article.html`：文章详情页模板
- `templates/assets/css/style.css`：导出按钮样式
- `templates/assets/js/articles-filters.js`：动态列表渲染修复

为划词评论（Text Selection Comment）系统新增评论编辑和删除功能。高亮文本的悬浮tooltip中，评论作者可看到编辑（铅笔）和删除（垃圾桶）按钮；编辑弹出框预填原评论内容，通过GitHub API PATCH更新Issue Comment；删除操作需二次确认，通过GitHub API DELETE移除。未定位评论区同样支持hover显示编辑/删除按钮。新增CSS样式：tooltip操作按钮组、危险按钮（红色）、删除确认对话框引用样式、未定位评论的操作按钮（hover显隐）。权限控制基于当前登录用户与评论作者的匹配判断，仅作者本人可操作。

## 划词评论功能修复与增强
date: 2026-02-14
修复划词评论GitHub登录404问题：将OAuth认证方式从Authorization Code Flow改为Device Flow，复用TODO页面已有的Cloudflare Worker代理（oauthProxyUrl），彻底消除对不存在的oauth-callback.html页面的依赖。修复评论提交无效的问题：当popover或device modal可见时不再清除currentSelection，确保用户在输入框中交互后仍能正常提交评论。悬浮评论框新增GitHub Issue跳转链接（GitHub图标），tooltip改为可交互模式并增加150ms延迟隐藏，方便用户点击链接。配置层新增oauthProxyUrl字段（types定义、blog.config.json、SiteGenerator页面注入）。

## 修复代码块样式：加载附加CSS与消除双边框
date: 2026-02-13
在layout.html中引入style-addition.css，使语言badge定位（左上角）、复制按钮定位（右上角）及hover显隐行为生效。同时在style.css的pre code规则中添加border: none，消除pre与内部code元素的双边框问题。

## 代码块增强：语法高亮与一键复制
date: 2026-02-13
为博客文章页面的代码块新增语法高亮和一键复制功能。通过CDN引入Highlight.js（GitHub Light/Dark双主题），在SiteGenerator中仅为文章页注入CDN资源。新建code-enhance.js实现：hljs.highlightAll()语法高亮初始化、MutationObserver监听data-theme属性实现主题切换同步、为每个pre>code块注入复制按钮（Clipboard API + execCommand降级）与语言标签badge。CSS层面在style-addition.css中添加复制按钮（hover显示、移动端常显）、语言badge（左上角定位）、pre块相对定位与padding适配，均支持亮/暗双主题。OpenSpec制品已同步code-highlight和code-copy两个新capability到主specs并归档。

## Articles页面视图切换功能实现与归档
date: 2026-02-13
实现Articles页面列表/文件夹双视图切换功能并完成OpenSpec归档。后端：SiteGenerator为文章数据新增relativePath字段（跨平台正斜杠路径）。前端：新增articles-folder-view.js实现从扁平路径构建树形目录、展开折叠交互、文章计数；articles-filters.js新增视图切换逻辑（URL ?view=folder参数持久化、容器显隐控制）。样式：视图切换按钮组、文件夹树缩进/图标/chevron动画、暗色模式适配、移动端响应式。OpenSpec制品已同步到主specs并归档至archive/2026-02-13-articles-view-toggle。

## Articles页面视图切换功能 - OpenSpec制品创建
date: 2026-02-13
为Articles页面新增视图切换功能创建了完整的OpenSpec变更制品（articles-view-toggle）。包含4个制品：proposal（动机与能力定义）、design（技术设计决策：relativePath数据传递、前端树构建、CSS class视图切换、URL参数持久化）、specs（3个规格文件：articles-folder-view文件夹视图、articles-view-switch视图切换、articles-pagination分页适配）、tasks（15个实现任务覆盖后端数据、UI切换、文件夹视图、样式、集成测试）。
