## 博客主题全面升级：日落橙温暖极简设计系统
date: 2026-02-15

将博客从冷色调 Cyan 蓝色主题全面升级为温暖的日落橙主题，实现现代极简美学设计。配色系统：采用 #FF8C42 日落橙为主色调，搭配深橙 #FF6F1E、浅橙 #FFB380、柔和橙 #FFE5D3，背景使用温暖米白色 #FFFCF9，文字使用深棕色系 #2D1810，暗色模式采用深棕背景 #1A0F08 保持温暖调性。字体系统：标题使用现代几何字体 Outfit（替代 Inter），正文使用优雅衬线字体 Crimson Pro（字号提升至 21px，行高 1.8），代码使用 JetBrains Mono（替代 Fira Code）。Hero 区域：超大标题（72px）带渐变文字效果、背景径向橙色光晕、淡入上移动画。文章卡片：悬停上移 6px、顶部橙色渐变条（悬停展开）、温暖阴影效果、Pill 形状标签。文章详情页：阅读宽度优化至 85ch、代码块柔和阴影、引用块渐变背景、清晰标题层级。交互动效：导航链接底部橙色下划线展开、主题切换按钮缩放旋转 20°、按钮悬停温暖阴影、所有过渡使用 cubic-bezier 缓动。间距系统：采用慷慨留白（Hero 96px、区块 64px、卡片 40px），所有颜色、字号、间距使用 CSS 变量统一管理。新增文件：design-preview.html（完整设计预览）、DESIGN_GUIDE.md（详细设计文档）、DESIGN_CHANGES.md（快速上手指南）。修改文件：templates/layout.html（更新字体引入）、templates/assets/css/style.css（1200+ 行全新样式系统）。

## 智能文章日期处理：优先使用 frontmatter 和 Git commit 时间
date: 2026-02-14

实现了智能的文章日期提取机制，解决了旧文章迁移时日期不准确的问题。新的日期优先级为：1) YAML frontmatter 中的 `date` 字段（最高优先级）2) frontmatter 中的 `created` 字段（兼容性）3) Git 第一次 commit 时间（自动提取）4) 文件系统时间（后备方案）。在 `MetadataParser.ts` 中新增 `getGitFirstCommitDate()` 方法，通过 `git log --follow` 命令自动获取文件的首次提交时间，支持文件重命名跟踪。修复了 git 命令的工作目录设置问题，使用仓库根目录作为 cwd 并计算相对路径。创建详细文档 `docs/DATE_HANDLING.md`，说明日期处理逻辑、使用场景和最佳实践。更新 `CLAUDE.md` 添加新功能说明。特别适合从其他平台迁移的旧文章，即使没有在 frontmatter 中声明日期，也能保持文章的真实创建时间。

## 新增 GitHub Actions 自动部署功能
date: 2026-02-14

创建了完整的 GitHub Actions 工作流配置，实现博客的自动化部署。添加主部署工作流 `deploy.yml`，支持代码 push 触发、定时任务（每小时）和手动触发。添加笔记更新即时触发工作流 `trigger-from-notes.yml`，通过 repository_dispatch 事件触发。配置正确的目录结构，使博客仓库 checkout 到 `code/shinerio.github.io/`，笔记仓库 checkout 到 `obsidian/obsidian/`，与 `blog.config.json` 中的 `vaultPath: "../../obsidian/obsidian"` 完全匹配。创建详细的配置指南 `GITHUB_ACTIONS_SETUP.md`，包含 GitHub Token 创建、Secret 配置、GitHub Pages 启用等步骤说明。提供 obsidian 仓库工作流模板文件，方便配置从笔记仓库即时触发部署。

## Cloudflare Worker 安全加固：限制 CORS 与请求过滤
date: 2026-02-14
针对 OAuth 代理 Worker 实施全面安全加固，将 CORS 从完全开放（`*`）改为严格限制仅允许 shinerio.site 域名调用。新增双重来源验证机制（Origin + Referer header），防止其他网站滥用 Worker。实现请求体白名单过滤（sanitizeRequestBody），仅保留 OAuth 必需字段（client_id、scope、device_code、grant_type），阻止注入攻击。添加 HTTP 方法限制（仅 POST/OPTIONS）、JSON 解析错误处理、预检请求缓存优化（24 小时）。修改后任何非授权来源请求将返回 403 Forbidden，同时保持本地开发环境（localhost）的兼容性。

## 划词评论增加编辑与删除功能
date: 2026-02-14
## 新增博客 Markdown 源文件导出功能
date: 2026-02-14

本次更新为博客系统添加了完整的 Markdown 源文件导出功能，允许读者直接下载文章的原始 Markdown 文件。

### 主要功能
1. **文章详情页导出按钮**：在每篇文章标题旁添加下载图标，点击即可下载该文章的 Markdown 源文件
2. **文章列表页导出按钮**：在文章列表中每个标题旁也添加了导出按钮，方便批量收藏
3. **智能文件命名**：下载的文件名使用文章标题（如"Getting Started.md"），而非 URL slug
4. **源文件存储**：所有 Markdown 文件自动复制到 `dist/assets/markdown/` 目录

### 技术实现
- **后端（SiteGenerator.ts）**：
  - 新增 `copyMarkdownFiles()` 方法，在生成网站时自动复制所有已发布文章的 Markdown 源文件
  - 文件使用 slug 命名存储（URL 安全），通过 HTML5 `download` 属性指定用户友好的下载文件名
  - 草稿文章不会被复制，确保隐私性
  - 更新 `renderArticleListItem()` 和 `generateArticlePages()` 方法，在 HTML 中添加导出按钮

- **前端模板**：
  - `article.html`：在文章标题区域添加导出按钮和响应式布局
  - `articles-filters.js`：修复动态渲染文章列表时导出按钮丢失的问题

- **样式（style.css）**：
  - 新增 `.markdown-export-btn` 样式，包含悬停动画效果
  - 支持深色模式
  - 移动端优化：更大的触摸目标（36x36px）

### 用户体验优化
- 使用 Feather Icons 的下载图标，视觉清晰美观
- 鼠标悬停时按钮颜色变化并轻微上浮，提供即时反馈
- 点击事件阻止冒泡，避免误触文章链接
- 完整的无障碍支持（aria-label, title 属性）

### 修复的问题
- 修复了文章列表页在使用筛选、排序、分页功能后导出按钮消失的 Bug
- 该问题是因为 JavaScript 动态重建文章列表时未包含导出按钮 HTML

### 文件变更
- `src/core/SiteGenerator.ts`：后端逻辑实现
- `templates/article.html`：文章详情页模板
- `templates/assets/css/style.css`：导出按钮样式
- `templates/assets/js/articles-filters.js`：动态列表渲染修复

为划词评论（Text Selection Comment）系统新增评论编辑和删除功能。高亮文本的悬浮tooltip中，评论作者可看到编辑（铅笔）和删除（垃圾桶）按钮；编辑弹出框预填原评论内容，通过GitHub API PATCH更新Issue Comment；删除操作需二次确认，通过GitHub API DELETE移除。未定位评论区同样支持hover显示编辑/删除按钮。新增CSS样式：tooltip操作按钮组、危险按钮（红色）、删除确认对话框引用样式、未定位评论的操作按钮（hover显隐）。权限控制基于当前登录用户与评论作者的匹配判断，仅作者本人可操作。

## 划词评论功能修复与增强
date: 2026-02-14
修复划词评论GitHub登录404问题：将OAuth认证方式从Authorization Code Flow改为Device Flow，复用TODO页面已有的Cloudflare Worker代理（oauthProxyUrl），彻底消除对不存在的oauth-callback.html页面的依赖。修复评论提交无效的问题：当popover或device modal可见时不再清除currentSelection，确保用户在输入框中交互后仍能正常提交评论。悬浮评论框新增GitHub Issue跳转链接（GitHub图标），tooltip改为可交互模式并增加150ms延迟隐藏，方便用户点击链接。配置层新增oauthProxyUrl字段（types定义、blog.config.json、SiteGenerator页面注入）。

## 修复代码块样式：加载附加CSS与消除双边框
date: 2026-02-13
在layout.html中引入style-addition.css，使语言badge定位（左上角）、复制按钮定位（右上角）及hover显隐行为生效。同时在style.css的pre code规则中添加border: none，消除pre与内部code元素的双边框问题。

## 代码块增强：语法高亮与一键复制
date: 2026-02-13
为博客文章页面的代码块新增语法高亮和一键复制功能。通过CDN引入Highlight.js（GitHub Light/Dark双主题），在SiteGenerator中仅为文章页注入CDN资源。新建code-enhance.js实现：hljs.highlightAll()语法高亮初始化、MutationObserver监听data-theme属性实现主题切换同步、为每个pre>code块注入复制按钮（Clipboard API + execCommand降级）与语言标签badge。CSS层面在style-addition.css中添加复制按钮（hover显示、移动端常显）、语言badge（左上角定位）、pre块相对定位与padding适配，均支持亮/暗双主题。OpenSpec制品已同步code-highlight和code-copy两个新capability到主specs并归档。

## Articles页面视图切换功能实现与归档
date: 2026-02-13
实现Articles页面列表/文件夹双视图切换功能并完成OpenSpec归档。后端：SiteGenerator为文章数据新增relativePath字段（跨平台正斜杠路径）。前端：新增articles-folder-view.js实现从扁平路径构建树形目录、展开折叠交互、文章计数；articles-filters.js新增视图切换逻辑（URL ?view=folder参数持久化、容器显隐控制）。样式：视图切换按钮组、文件夹树缩进/图标/chevron动画、暗色模式适配、移动端响应式。OpenSpec制品已同步到主specs并归档至archive/2026-02-13-articles-view-toggle。

## Articles页面视图切换功能 - OpenSpec制品创建
date: 2026-02-13
为Articles页面新增视图切换功能创建了完整的OpenSpec变更制品（articles-view-toggle）。包含4个制品：proposal（动机与能力定义）、design（技术设计决策：relativePath数据传递、前端树构建、CSS class视图切换、URL参数持久化）、specs（3个规格文件：articles-folder-view文件夹视图、articles-view-switch视图切换、articles-pagination分页适配）、tasks（15个实现任务覆盖后端数据、UI切换、文件夹视图、样式、集成测试）。
