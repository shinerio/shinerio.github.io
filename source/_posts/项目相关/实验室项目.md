---
title: 实验室项目整理
date: 2019-08-31
categories:
- 项目
tags:
- 项目
password: loveshinerio   
abstract: 实验室项目整理
message: 密码
---

## 国家电网能力开放平台

### 项目背景

国家电网电车公司面向服务提供方(ISP)和应用开发方(ISV)设计开发的能力开放平台。以有效整合服务资源，通过能力的开放吸引合作伙伴入驻开发应用，吸引最终消费者的使用。ISP提供基础能力，ISV方基于ISP基础能力开发应用供普通用户使用。

### 时间

2018年9月——2019年5月

### 开发环境

- 数据库：mysql
- 运行环境：阿里私有云，edas
- 中间件：HSF
- 开发语言：java
- 开发框架：Spring+Mbaits

### 整体架构

![](https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images/uncategory/国家电网.png)

### 主要工作内容

- 管理模块

  - 文档中心
  - api的发布、订阅、审核等
  - 门户首页

- 架构设计

- 微服务思想

  [点我查看更多](https://shinerio.oss-cn-beijing.aliyuncs.com/document/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%AC%94%E8%AE%B0.pdf)

- 协议转换

  内部接口使用HSF接口进行，用户以http接口访问系统。需要进行http->HSF的协议转换。Map缓存http-hsf映射关系，API系统完成HSF调用，并解析结果，统一格式后，http response方式响应给用户。

- 系统网关

  系统网关的整体设计采用策略模式，正常API调用与测试调用分别采用不同的策略。程序运行时动态执行网关控制，通过Spring AOP方式拦截接口调用，在Around方法中，调用之前和调用之后分别进行一些控制（先扣费，后扣费，日志记录等）

  [点我查看更多](https://shinerio.oss-cn-beijing.aliyuncs.com/document/API%E8%AE%BF%E9%97%AE%E5%92%8C%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%9D%97.pdf)

  - 流量控制

    基于redis+lua实现基于固定时间分片的分布式限流，对于每个ISV应用进行限流，redis设计为appID_apiID_timemark，value计数。如appID_apiID_second，同一秒内key相同，限制value不超过10次。

    [点我查看更多](https://shinerio.cc/2019/03/14/系统设计/流控/)

    [点我进一步了解(*╹▽╹*)](https://shinerio.oss-cn-beijing.aliyuncs.com/document/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6.pdf)

  - 计费

    采用工厂模式方式，包年包月计费、按流量计费、按次数计费等，用户订阅接口后，数据库存相关计费接口实现类全限定名，反射调用。

  - 权限控制

    对于接口资源调度控制，采用树型权限设计，根节点权限最大（包含所有叶子节点权限），叶子节点分别代表不同单一权限，总公司、省级公司、地区公司等资源具有不同权限级别，数据库采用最左匹配原则得到能够具有的所有权限。

    [点我了解更多](https://shinerio.oss-cn-beijing.aliyuncs.com/document/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%9D%97.pdf）

### 问题解决

国网项目上线，开发周期比较短，经常是我们这边刚开发好，那边就催着上线，然后就出现了线下测试通过，部署线上的时候却发现工程起不来。因为国网使用的阿里云企业级服务，然后是与外网隔绝的，我们平常都是有网环境开发，所以排查这个错误也是用了很久。刚开始国网技术人员和我实验室的其他小伙伴都觉得可能是环境配置的问题，然后大家就在一起检查了很久，把配置文件，代码种种检查了很多遍，采用控制变量法，但都无济于事。后来，我冷静下来，仔细分析日志输出，发现项目每次启动的时候都会去发起http请求，下载一些协议文件。而线上部署发现项目启动很快就会报错失败，推测有可能是web程序启动时一些网络资源请求不到。然后我就通过在有网环境下部署应用，分析应用加载网络资源，找出了缺失的网络配置文件。当把这些文件都以资源文件的形式打包到项目工程中去的时候，问题就顺利解决了。

### 感悟

在做这个项目之前，其实做过不少项目，但都是比较小的项目，可能也不会有过多的设计和考虑在里面，网上找个开源框架，照着怼一怼也差不多出来了。但是国网这个项目不一样，它是一个非常大的项目，目标是国家电网下属电车公司做的一个能力开发平台。刚开始其实对能力开发平台了解并不是很深，然后其实阿里、腾讯、百度、华为等都有自己的能力开发平台，通过对其他平台的参考和借鉴，然后和国网的技术人员进行探讨，最终决定采用微服务的架构来设计项目。因为项目周期比较短，就两个月的时间，作为项目负责人的我其实那段时间压力特别大，经常和同学一起加班到很晚，为了赶项目功能上线，需要通宵赶deadline的。我觉得人在压力下反而更容易爆发出潜能，我觉得这个项目是我接受的第一大项目，我学习到了很多，弥补了自己很多的知识盲区。

## 人体姿态估计算法平台

### 项目背景

本项目来源是北京邮电大学的创新创业项目，主要目的是为了搭建基于人体姿态估计算法的平台，分为web端应用和算法模型。用户在家中使用普通的2D摄像头，辅助进行健身和康复训练提供检测和指导。项目获得了获得了学校的研究生创新创业大赛的一等奖。

### 时间

2018年11月——2019年5月

### 开发环境

- 数据库: mysql
- 中间件: activeMQ、redis
- 开发语言: java(web)、python（算法模型）
- 框架SpringMVC+Mybaits

### 整体架构

![image-20190831203451527](https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images/uncategory/20190831203401.png)

### 主要工作内容

- 模型设计与实现

  - 深度神经网络模型，ResNet34/ResNet50/ResNet101/ResNet152
    - offset-guided + Deconv
    - add detected box for train
    - oks+iou NMS
  - coding by python + pytorch 
  - run with Tesla M40

- 平台设计与实现

  - SpringMVC + Mybaits，`医生/健身教练+病患/健身爱好者`平台
  - 动作库+算法预估+智能建议

  - 能力开放平台，人脸识别/姿态估计/行为识别等，api形式
  - 后续利用SpringCloud + Spring boot进行改进

- 前段

  NodeJS写redis

- 中间件耦合

  使用redis作为消息队列，异步解耦、流量削峰。为什么要用redis，内存型，实时性要求高。

  