---
title: 堆(heap)和栈(stack)
date: 2016-12-9 21:55:29
categories:
- 计算机基础
tags:
- java
- 数据结构
---

# 堆（heap）

堆内存存放程序员主动创建的对象（new创建的对象或数据）。堆中分配的内存，生命周期是在运行时被java虚拟机自动垃圾回收机制动态管理的，需要大量的时间在堆中分配存储空间。

# 栈（stack）

栈内存存放一些基本类型的变量和对象引用变量。当定义一个变量时，Java就在栈中为这个变量分配内存空间，当超过变量的作用域后，Java会自动释放掉为该变量所分配的内存空间，该内存空间可以立即被另作他用。 

# 变量的作用域

```java
{
  int x =1;//x可获得
  {
    int y = 2;//x和y都可获得
  }
  //超出y的作用域，只有x可获得
}
//**************************
{
	int x = 1;
  {
   // int x = 2; //duplicate local variable x(变量已定义)
  }
}
```

# 对象与引用

```java
{
  String s = new String("hello world");
}
//引用s是普通变量，超出作用域就消失了，而new出来的String对象仍然占据内存空间，等待垃圾回收机制处理（因此java程序会相对比较占内存）
```

# 栈的优势

存在于栈中的数据可以共享，存取速度快，但是生存周期与占据内存大小必须确定

example:

```java
int a = 3; 
int b = 3; 
```

编译器先处理int a = 3;首先它会在栈中创建一个变量为a的引用，然后查找栈中是否有3这个值，如果没找到，就将3存放进来，然后将a指向3。接着处理int b = 3;在创建完b的引用变量后，因为在栈中已经有3这个值，便将b直接指向3。这样，就出现了a与b同时均指向3的情况。这时，如果再令a=4;那么编译器会重新搜索栈中是否有4值，如果没有，则将4存放进来，并令a指向4;如果已经有了，则直接将a指向这个地址。因此a值的改变不会影响到b的值。要注意这种数据的共享与两个对象的引用同时指向一个对象的这种共享是不同的，因为这种情况a的修改并不会影响到b, 它是由编译器完成的，它有利于节省空间。而一个对象引用变量修改了这个对象的内部状态，会影响到另一个对象引用变量 