<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°„ - Shinerio's Blog</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body class="article-page" id="theme-body">
    <div class="page-wrapper">
        <header class="page-header">
            <div class="container">
                <nav class="page-nav">
                    <div class="nav-links">
                        <a href="index.html" class="nav-link ">Home</a>
                        <a href="articles.html" class="nav-link ">Articles</a>
                        <a href="search.html" class="nav-link ">Search</a>
                    </div>
                    <div class="theme-toggle-container">
                        <button id="theme-toggle" aria-label="Toggle dark mode" class="theme-toggle-btn">
                            <span class="sun-icon">â˜€ï¸</span>
                            <span class="moon-icon">ğŸŒ™</span>
                        </button>
                    </div>
                </nav>
            </div>
        </header>
        <main class="page-main">
            <div class="container">
                <article>
    <header>
        <h1>åå°„</h1>
        <time datetime="2026-01-03T13:04:29.156Z">2026å¹´1æœˆ3æ—¥</time>
        <div class="tags">
            
        </div>
    </header>
    <section class="content">
        {<h1>1. ä»»æ„ç±»å‹</h1>
<p>åœ¨ Go è¯­è¨€ä¸­ï¼Œ<code>interface{}</code> å¸¸è¢«ç§°ä¸ºâ€œç©ºæ¥å£â€ï¼Œå®ƒçš„ç¡®èƒ½æ‰¿è½½&lt;span style=&quot;background:<span class="tag">#fff88f</span>&quot;&gt;ä»»æ„ç±»å‹</span>çš„å€¼ï¼Œä½†è¿™ç§â€œä¸‡èƒ½â€ç‰¹æ€§èƒŒåå­˜åœ¨æ˜æ˜¾çš„<strong>æƒè¡¡å’Œå±€é™æ€§</strong>ã€‚<code>interface{}</code>ä¹Ÿå¯ä»¥ç”¨<code>any</code>å…³é”®è¯æ›¿ä»£ï¼Œ<code>type any = interface{}</code></p>
<pre><code class="language-go">package main

import &quot;log&quot;

func main() {
    var anyItem interface{}
    // ç­‰ä»·äºvar anyItem any 
    anyItem = 42         // int
    anyItem = &quot;hello&quot;    // string
    anyItem = struct{}{} // åˆå§‹åŒ–ç©ºç»“æ„ä½“
    log.Printf(&quot;%v&quot;, anyItem)
}
</code></pre>
<p>go çš„æ¥å£æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼Œä¸€éƒ¨åˆ†æ˜¯ç±»å‹ä¿¡æ¯ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯æ•°æ®ä¿¡æ¯</p>
<pre><code class="language-go">var a = 1 
var b interface{} = a
</code></pre>
<p>å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œ<code>b</code>Â çš„ç±»å‹ä¿¡æ¯æ˜¯Â <code>int</code>ï¼Œæ•°æ®ä¿¡æ¯æ˜¯Â <code>1</code>ï¼Œè¿™ä¸¤éƒ¨åˆ†ä¿¡æ¯éƒ½æ˜¯å­˜å‚¨åœ¨Â <code>b</code>Â é‡Œé¢çš„ã€‚<code>b</code>Â çš„å†…å­˜ç»“æ„<br><img src="https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images20250302192731548.png" alt="image.png"><br>åœ¨ä¸Šå›¾ä¸­ï¼Œ<code>b</code>Â çš„ç±»å‹å®é™…ä¸Šæ˜¯Â <code>eface</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="language-go">type eface struct {
    _type *_type
    data  unsafe.Pointer
}
</code></pre>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª<code>interface{}</code>ä¸­å®é™…ä¸Šæ—¢åŒ…å«äº†å˜é‡çš„ç±»å‹ä¿¡æ¯ï¼Œä¹ŸåŒ…å«äº†ç±»å‹çš„æ•°æ®ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘ä»¬æ‰å¯ä»¥é€šè¿‡åå°„æ¥è·å–åˆ°å˜é‡çš„ç±»å‹ä¿¡æ¯ï¼Œä»¥åŠå˜é‡çš„æ•°æ®ä¿¡æ¯ã€‚</p>
<h1>2. åå°„</h1>
<p>Goä¸­çš„åå°„æ˜¯ç”¨reflectåŒ…å®ç°ï¼ŒreflectåŒ…å®ç°äº†è¿è¡Œæ—¶çš„åå°„èƒ½åŠ›ï¼Œèƒ½å¤Ÿè®©ç¨‹åºæ“ä½œä¸åŒçš„å¯¹è±¡ã€‚</p>
<p>Goä¸­çš„åå°„æ˜¯å»ºç«‹åœ¨ç±»å‹ç³»ç»Ÿä¹‹ä¸Šï¼Œå®ƒä¸ç©ºæ¥å£<code>interface{}</code>å¯†åˆ‡ç›¸å…³ã€‚æ¯ä¸ª<code>interface{}</code>ç±»å‹çš„å˜é‡åŒ…å«ä¸€å¯¹å€¼<code>(typeï¼Œvalue)</code>ï¼Œtype è¡¨ç¤ºå˜é‡çš„ç±»å‹ä¿¡æ¯ï¼Œvalue è¡¨ç¤ºå˜é‡çš„å€¼ä¿¡æ¯ã€‚</p>
<blockquote>
<p>[!info]<br>æ‰€ä»¥ nil!=nilï¼Œå°±å¯ä»¥ç†è§£äº†ã€‚</p>
</blockquote>
<pre><code class="language-go">package main

import (
    &quot;log&quot;
)

func main() {
    var a any
    var b any
    log.Println(a, b)   //&lt;nil&gt; &lt;nil&gt;
    log.Println(a != b) // false
}
</code></pre>
<p>reflectæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š</p>
<ul>
<li><code>reflect.TypeOf()</code>Â è·å–ç±»å‹ä¿¡æ¯ï¼Œè¿”å›Â <a href="https://cs.opensource.google/go/go/+/refs/tags/go1.18.8:src/reflect/type.go;l=39">Type</a>Â ç±»å‹ï¼›</li>
<li><code>reflect.ValueOf()</code>Â è·å–æ•°æ®ä¿¡æ¯ï¼Œè¿”å›Â <a href="https://cs.opensource.google/go/go/+/refs/tags/go1.18.8:src/reflect/value.go;l=39">Value</a>Â ç±»å‹ã€‚<br>é˜…è¯»<code>TypeOf</code> å’Œ <code>ValueOf</code> çš„æºç ä¼šå‘ç°ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ¥æ”¶ä¸€ä¸ª <code>interface{}</code> ç±»å‹çš„å‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ª <code>reflect.Type</code> å’Œ <code>reflect.Value</code> ç±»å‹çš„å€¼ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>reflect.TypeOf</code> å’Œ <code>reflect.ValueOf</code> æ¥è·å–åˆ°ä¸€ä¸ªå˜é‡çš„ç±»å‹å’Œå€¼çš„åŸå› ã€‚<br><img src="https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images20250302193030734.png" alt="image.png"></li>
</ul>
<h2>2.1. åå°„å®šå¾‹</h2>
<ol>
<li>åå°„å¯ä»¥å°†Â <code>interface</code>Â ç±»å‹å˜é‡è½¬æ¢æˆåå°„å¯¹è±¡ã€‚</li>
<li>åå°„å¯ä»¥å°†åå°„å¯¹è±¡è¿˜åŸæˆÂ <code>interface</code>Â å¯¹è±¡ã€‚</li>
<li>å¦‚æœè¦ä¿®æ”¹åå°„å¯¹è±¡ï¼Œé‚£ä¹ˆåå°„å¯¹è±¡å¿…é¡»æ˜¯å¯è®¾ç½®çš„ï¼ˆ<code>CanSet</code>ï¼‰ã€‚</li>
</ol>
<h3>2.1.1. åå°„å¯ä»¥å°†Â <code>interface</code>ç±»å‹å˜é‡è½¬æ¢æˆåå°„å¯¹è±¡</h3>
<pre><code class="language-go">var a = 1
typeOfA := reflect.TypeOf(a)
valueOfA := reflect.ValueOf(a)
</code></pre>
<h3>2.1.2. åå°„å¯ä»¥å°†åå°„å¯¹è±¡è¿˜åŸæˆÂ <code>interface</code>Â å¯¹è±¡</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡Â <code>reflect.Value.Interface</code>Â æ¥è·å–åˆ°åå°„å¯¹è±¡çš„Â <code>interface</code>Â å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¼ é€’ç»™Â <code>reflect.ValueOf</code>Â çš„é‚£ä¸ªå˜é‡æœ¬èº«ã€‚ ä¸è¿‡è¿”å›å€¼ç±»å‹æ˜¯Â <code>interface{}</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œç±»å‹æ–­è¨€ã€‚</p>
<pre><code class="language-go">var a = 1
valueOfA := reflect.ValueOf(a)
i := valueOfA.Interface()
fmt.Println(i.(int))   // 1
</code></pre>
<h3>2.1.3. å¦‚æœè¦ä¿®æ”¹åå°„å¯¹è±¡ï¼Œé‚£ä¹ˆåå°„å¯¹è±¡å¿…é¡»æ˜¯å¯è®¾ç½®çš„ï¼ˆ<code>CanSet</code>ï¼‰</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>reflect.Value.CanSet</code> æ¥åˆ¤æ–­ä¸€ä¸ªåå°„å¯¹è±¡æ˜¯å¦æ˜¯å¯è®¾ç½®çš„ã€‚å¦‚æœæ˜¯å¯è®¾ç½®çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ <code>reflect.Value.Set</code> æ¥ä¿®æ”¹åå°„å¯¹è±¡çš„å€¼ã€‚ è¿™å…¶å®ä¹Ÿæ˜¯éå¸¸åœºæ™¯çš„ä½¿ç”¨åå°„çš„ä¸€ä¸ªåœºæ™¯ï¼Œé€šè¿‡åå°„æ¥ä¿®æ”¹å˜é‡çš„å€¼ã€‚</p>
<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;reflect&quot;
)

func main() {
    var x float64 = 3.4
    v := reflect.ValueOf(&amp;x)
    fmt.Println(&quot;settability of v:&quot;, v.CanSet())        // false
    fmt.Println(&quot;settability of v:&quot;, v.Elem().CanSet()) // true
}
</code></pre>
<p>åå°„å¯¹è±¡æ˜¯å¯è®¾ç½®çš„æ¡ä»¶ï¼š</p>
<ul>
<li>åå°„å¯¹è±¡æ˜¯ä¸€ä¸ªæŒ‡é’ˆ</li>
<li>è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå¯è®¾ç½®çš„å˜é‡<br>åœ¨æˆ‘ä»¬ä¼ é€’ä¸€ä¸ªå€¼ç»™ <code>reflect.ValueOf</code> çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªå€¼åªæ˜¯ä¸€ä¸ªæ™®é€šçš„å˜é‡ï¼Œé‚£ä¹ˆ <code>reflect.ValueOf</code>ä¼šè¿”å›ä¸€ä¸ªä¸å¯è®¾ç½®çš„åå°„å¯¹è±¡ã€‚ å› ä¸ºè¿™ä¸ªå€¼å®é™…ä¸Šè¢«æ‹·è´äº†ä¸€ä»½ï¼Œæˆ‘ä»¬å¦‚æœé€šè¿‡åå°„ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œé‚£ä¹ˆå®é™…ä¸Šæ˜¯ä¿®æ”¹çš„è¿™ä¸ªæ‹·è´çš„å€¼ï¼Œè€Œä¸æ˜¯åŸæ¥çš„å€¼ã€‚ æ‰€ä»¥goè¯­è¨€åœ¨è¿™é‡Œåšäº†ä¸€ä¸ªé™åˆ¶ï¼Œå¦‚æœæˆ‘ä»¬ä¼ é€’è¿› <code>reflect.ValueOf</code> çš„å˜é‡æ˜¯ä¸€ä¸ªæ™®é€šçš„å˜é‡ï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬è®¾ç½®åå°„å¯¹è±¡çš„å€¼çš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ã€‚ æ‰€ä»¥åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’äº†<code>x</code>çš„æŒ‡é’ˆå˜é‡ä½œä¸ºå‚æ•°ã€‚è¿™æ ·ï¼Œè¿è¡Œæ—¶å°±å¯ä»¥æ‰¾åˆ° <code>x</code> æœ¬èº«ï¼Œè€Œä¸æ˜¯ <code>x</code> çš„æ‹·è´ï¼Œæ‰€ä»¥å°±å¯ä»¥ä¿®æ”¹ <code>x</code> çš„å€¼äº†ã€‚</li>
</ul>
<p>ä½†åŒæ—¶æˆ‘ä»¬ä¹Ÿæ³¨æ„åˆ°äº†ï¼Œåœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>v.CanSet()</code> è¿”å›çš„æ˜¯ <code>false</code>ï¼Œè€Œ <code>v.Elem().CanSet()</code> è¿”å›çš„æ˜¯ <code>true</code>ã€‚ è¿™æ˜¯å› ä¸ºï¼Œ<code>v</code> æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè€Œ <code>v.Elem()</code> æ˜¯æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œå¯¹äºè¿™ä¸ªæŒ‡é’ˆæœ¬èº«ï¼Œæˆ‘ä»¬ä¿®æ”¹å®ƒæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥è®¾æƒ³ä¸€ä¸‹ï¼Œ å¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†æŒ‡é’ˆå˜é‡ï¼ˆä¹Ÿå°±æ˜¯ä¿®æ”¹äº†æŒ‡é’ˆå˜é‡æŒ‡å‘çš„åœ°å€ï¼‰ï¼Œé‚£ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿé‚£æ ·æˆ‘ä»¬çš„æŒ‡é’ˆå˜é‡å°±ä¸æ˜¯æŒ‡å‘ <code>x</code> äº†ï¼Œ è€Œæ˜¯æŒ‡å‘äº†å…¶ä»–çš„å˜é‡ï¼Œè¿™æ ·å°±ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸäº†ã€‚æ‰€ä»¥ <code>v.CanSet()</code> è¿”å›çš„æ˜¯ <code>false</code>ã€‚è€Œ <code>v.Elem().CanSet()</code> è¿”å›çš„æ˜¯ <code>true</code>ã€‚è¿™æ˜¯å› ä¸º <code>v.Elem()</code> æ‰æ˜¯ <code>x</code> æœ¬èº«ï¼Œé€šè¿‡ <code>v.Elem()</code> ä¿®æ”¹ <code>x</code> çš„å€¼æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚<br><img src="https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images20250302194050775.png" alt="image.png"></p>
<h2>2.2. elemæ–¹æ³•</h2>
<p><code>reflect.Value</code>Â å’ŒÂ <code>reflect.Type</code>Â è¿™ä¸¤ä¸ªåå°„å¯¹è±¡éƒ½æœ‰Â <code>Elem</code>Â æ–¹æ³•ï¼Œæ—¢ç„¶æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä»¬çš„ä½œç”¨è‡ªç„¶æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<h3>2.2.1. reflect.Value çš„ Elem æ–¹æ³•</h3>
<p><code>reflect.Value</code> çš„ <code>Elem</code> æ–¹æ³•çš„ä½œç”¨æ˜¯<strong>è·å–æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œæˆ–è€…è·å–æ¥å£çš„åŠ¨æ€å€¼</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œèƒ½è°ƒç”¨ <code>Elem</code> æ–¹æ³•çš„åå°„å¯¹è±¡ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªæŒ‡é’ˆæˆ–è€…ä¸€ä¸ªæ¥å£ã€‚ åœ¨ä½¿ç”¨å…¶ä»–ç±»å‹çš„ <code>reflect.Value</code> æ¥è°ƒç”¨ <code>Elem</code> æ–¹æ³•çš„æ—¶å€™ï¼Œä¼š <code>panic</code>:</p>
<pre><code class="language-go">package main

import (
    &quot;log&quot;
    &quot;reflect&quot;
)

func main() {
    var a = 1

    var b = &amp;a
    var v reflect.Value = reflect.ValueOf(b)
    log.Printf(&quot;%v&quot;, v.Elem())   // 1
    log.Println(&quot;value is: &quot;, v) // 10xc0000120d0

    // panic: reflect: call of reflect.Value.Elem on int Value
    reflect.ValueOf(a).Elem()
}
</code></pre>
<p>å¯¹äºæŒ‡é’ˆå¾ˆå¥½ç†è§£ï¼Œå…¶å®ä½œç”¨ç±»ä¼¼è§£å¼•ç”¨ã€‚è€Œå¯¹äºæ¥å£ï¼Œè¿˜æ˜¯è¦å›åˆ°Â <code>interface</code>Â çš„ç»“æ„æœ¬èº«ï¼Œå› ä¸ºæ¥å£é‡ŒåŒ…å«äº†ç±»å‹å’Œæ•°æ®æœ¬èº«ï¼Œæ‰€ä»¥Â <code>Elem</code>Â æ–¹æ³•å°±æ˜¯è·å–æ¥å£çš„æ•°æ®éƒ¨åˆ†ï¼ˆä¹Ÿå°±æ˜¯Â <code>iface</code>Â æˆ–Â <code>eface</code>Â ä¸­çš„Â <code>data</code>Â å­—æ®µï¼‰ã€‚</p>
<p>æŒ‡é’ˆç±»å‹ï¼š<br><img src="https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images20250302200706997.png" alt="image.png"><br>æ¥å£ç±»å‹ï¼š<br><img src="https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images20250302200814348.png" alt="image.png"></p>
<h3>2.2.2. reflect.Typeçš„Elemæ–¹æ³•</h3>
<p><code>reflect.Type</code> çš„ <code>Elem</code> æ–¹æ³•çš„ä½œç”¨æ˜¯<strong>è·å–æ•°ç»„ã€chanã€mapã€æŒ‡é’ˆã€åˆ‡ç‰‡å…³è”å…ƒç´ çš„ç±»å‹ä¿¡æ¯</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äº <code>reflect.Type</code> æ¥è¯´ï¼Œ èƒ½è°ƒç”¨ <code>Elem</code> æ–¹æ³•çš„åå°„å¯¹è±¡ï¼Œå¿…é¡»æ˜¯<strong>æ•°ç»„ã€chanã€mapã€æŒ‡é’ˆã€åˆ‡ç‰‡ä¸­çš„ä¸€ç§</strong>ï¼Œå…¶ä»–ç±»å‹çš„ <code>reflect.Type</code> è°ƒç”¨ <code>Elem</code> æ–¹æ³•ä¼š <code>panic</code>ã€‚</p>
<pre><code class="language-go">t1 := reflect.TypeOf([3]int{1, 2, 3}) // æ•°ç»„ [3]int
fmt.Println(t1.String()) // [3]int
fmt.Println(t1.Elem().String()) // int
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦è·å– map ç±»å‹ key çš„ç±»å‹ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨Â <code>Key</code>Â æ–¹æ³•ï¼Œè€Œä¸æ˜¯Â <code>Elem</code>Â æ–¹æ³•ã€‚</p>
<pre><code class="language-go">m := make(map[string]string)
t1 := reflect.TypeOf(m)
fmt.Println(t1.Key().String()) // string
</code></pre>
<h3>2.2.3. interfaceæ–¹æ³•</h3>
<p>è¿™ä¹Ÿæ˜¯éå¸¸å¸¸ç”¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œ<code>reflect.Value</code> çš„ <code>Interface</code> æ–¹æ³•çš„ä½œç”¨æ˜¯<strong>è·å–åå°„å¯¹è±¡çš„åŠ¨æ€å€¼</strong>ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåå°„å¯¹è±¡æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé‚£ä¹ˆ <code>Interface</code> æ–¹æ³•ä¼šè¿”å›æŒ‡é’ˆæŒ‡å‘çš„å€¼ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œå¦‚æœ <code>var i interface{} = x</code>ï¼Œé‚£ä¹ˆ <code>reflect.ValueOf(x).Interface()</code> å°±æ˜¯ <code>i</code> æœ¬èº«ï¼Œåªä¸è¿‡å…¶ç±»å‹æ˜¯ <code>interface{}</code> ç±»å‹ã€‚å¯ä»¥é€šè¿‡<code>reflect.ValueOf(x).Interface().(T)</code>æ¥æ–­è¨€è·å–å®é™…ç±»å‹çš„å€¼ã€‚</p>
<h2>2.3. kindæ–¹æ³•</h2>
<p>åœ¨goä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨typeå…³é”®è¯åŸºäºåŸºæœ¬ç±»å‹æ¥å®šä¹‰å„ç§æ–°çš„ç±»å‹ï¼Œå¦‚ï¼š</p>
<pre><code class="language-go">// Kind æ˜¯ int
type myIny int
// Kind æ˜¯ Struct
type Person struct {
    Name string
    Age int
}
</code></pre>
<p>ä¸ç®¡æˆ‘ä»¬å®šä¹‰äº†å¤šå°‘ç§ç±»å‹ï¼Œåœ¨goçœ‹æ¥éƒ½æ˜¯ä¸‹é¢çš„åŸºæœ¬ç±»å‹ä¸­çš„ä¸€ä¸ªï¼š</p>
<pre><code class="language-go">type Kind uint

const (
   Invalid Kind = iota
   Bool
   Int
   Int8
   Int16
   Int32
   Int64
   Uint
   Uint8
   Uint16
   Uint32
   Uint64
   Uintptr
   Float32
   Float64
   Complex64
   Complex128
   Array
   Chan
   Func
   Interface
   Map
   Pointer
   Slice
   String
   Struct
   UnsafePointer
)
</code></pre>
<p>æˆ‘ä»¬å®šä¹‰çš„ç±»å‹åœ¨goçš„ç±»å‹ç³»ç»Ÿä¸­éƒ½æ˜¯åŸºæœ¬ç±»å‹çš„ä¸€ç§ï¼Œè¿™ä¸ªåŸºæœ¬ç±»å‹å°±æ˜¯ <code>Kind</code>ã€‚ ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>æœ‰é™çš„</strong> <code>reflect.Type</code> çš„ <code>Kind</code> æ¥è¿›è¡Œç±»å‹åˆ¤æ–­ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨é€šè¿‡åå°„æ¥åˆ¤æ–­å˜é‡çš„ç±»å‹çš„æ—¶å€™ï¼Œåªéœ€è¦æšä¸¾ <code>Kind</code> ä¸­çš„ç±»å‹ï¼Œç„¶åé€šè¿‡ <code>reflect.Type</code> çš„ <code>Kind</code> æ–¹æ³•æ¥åˆ¤æ–­å³å¯ã€‚</p>
<pre><code class="language-go">func display(path string, v reflect.Value) {
   switch v.Kind() {
   case reflect.Invalid:
      fmt.Printf(&quot;%s = invalid\n&quot;, path)
   case reflect.Slice, reflect.Array:
      for i := 0; i &lt; v.Len(); i++ {
         display(fmt.Sprintf(&quot;%s[%d]&quot;, path, i), v.Index(i))
      }
   case reflect.Struct:
      for i := 0; i &lt; v.NumField(); i++ {
         fieldPath := fmt.Sprintf(&quot;%s.%s&quot;, path, v.Type().Field(i).Name)
         display(fieldPath, v.Field(i))
      }
   case reflect.Map:
      for _, key := range v.MapKeys() {
         display(fmt.Sprintf(&quot;%s[%s]&quot;, path, formatAny(key)), v.MapIndex(key))
      }
   case reflect.Pointer:
      if v.IsNil() {
         fmt.Printf(&quot;%s = nil\n&quot;, path)
      } else {
         display(fmt.Sprintf(&quot;(*%s)&quot;, path), v.Elem())
      }
   case reflect.Interface:
      if v.IsNil() {
         fmt.Printf(&quot;%s = nil\n&quot;, path)
      } else {
         fmt.Printf(&quot;%s.type = %s\n&quot;, path, v.Elem().Type())
         display(path+&quot;.value&quot;, v.Elem())
      }
   default:
      fmt.Printf(&quot;%s = %s\n&quot;, path, formatAny(v))
   }
}
</code></pre>
<h2>2.4. addressable</h2>
<p>goåå°„ä¸­æœ€åä¸€ä¸ªå¾ˆé‡è¦çš„è¯é¢˜æ˜¯addressableã€‚åœ¨goçš„åå°„ç³»ç»Ÿä¸­æœ‰ä¸¤ä¸ªå…³äºå¯»å€çš„æ–¹æ³•ï¼š<code>CanAddr</code>å’Œ<code>CanSet</code>ã€‚<br><code>CanAddr</code>æ–¹æ³•çš„ä½œç”¨æ˜¯åˆ¤æ–­åå°„å¯¹è±¡æ˜¯å¦å¯ä»¥å¯»å€</p>
<ul>
<li>å¦‚æœ<code>CanAddr</code>è¿”å› trueï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Addr æ–¹æ³•æ¥è·å–åå°„å¯¹è±¡çš„åœ°å€ã€‚</li>
<li>å¦‚æœ<code>CanAddr</code>è¿”å› falseï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸èƒ½é€šè¿‡ Addr æ–¹æ³•æ¥è·å–åå°„å¯¹è±¡çš„åœ°å€ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±æ— æ³•é€šè¿‡åå°„å¯¹è±¡æ¥ä¿®æ”¹å˜é‡çš„å€¼ã€‚<br>ä½†æ˜¯ï¼ŒCanAddræ˜¯trueå¹¶ä¸æ˜¯è¯´<code>reflect.Value</code>ä¸€å®šå°±èƒ½ä¿®æ”¹å˜é‡çš„å€¼äº†ã€‚<code>reflect.Value</code>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•<code>CanSet</code>ï¼Œåªæœ‰<code>CanSet</code>è¿”å› trueï¼Œæˆ‘ä»¬æ‰èƒ½é€šè¿‡åå°„å¯¹è±¡æ¥ä¿®æ”¹å˜é‡çš„å€¼ã€‚</li>
</ul>
<h2>2.5. è·å–ç±»å‹ä¿¡æ¯ - reflect.Type</h2>
<p><code>reflect.Type</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒä»£è¡¨äº†ä¸€ä¸ªç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>reflect.TypeOf</code> æ¥è·å–ä¸€ä¸ªç±»å‹çš„ <code>reflect.Type</code> å¯¹è±¡ã€‚ æˆ‘ä»¬ä½¿ç”¨ <code>reflect.Type</code> çš„ç›®çš„é€šå¸¸æ˜¯ä¸ºäº†è·å–ç±»å‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç±»å‹æ˜¯ä»€ä¹ˆã€ç±»å‹çš„åç§°ã€ç±»å‹çš„å­—æ®µã€ç±»å‹çš„æ–¹æ³•ç­‰ç­‰ã€‚ åˆæˆ–è€…æœ€å¸¸è§çš„åœºæ™¯ï¼šç»“æ„ä½“ä¸­çš„ <code>json</code> çš„ <code>tag</code>ï¼Œå®ƒæ˜¯æ²¡æœ‰è¯­ä¹‰çš„ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ä¸ºäº†åœ¨åºåˆ—åŒ–çš„æ—¶å€™ï¼Œç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„å­—æ®µåã€‚ è€Œè¿™ä¸ª <code>tag</code> å°±æ˜¯éœ€è¦é€šè¿‡åå°„æ¥è·å–çš„ã€‚</p>
<p><code>reflect.Type</code>Â è¿™ä¸ªæ¥å£æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œä¸‹é¢è¿™äº›æ–¹æ³•æ˜¯<strong>æ‰€æœ‰çš„ç±»å‹é€šç”¨</strong>çš„æ–¹æ³•:</p>
<pre><code class="language-go">// Type æ˜¯ Go ç±»å‹çš„è¡¨ç¤ºã€‚
//
// å¹¶éæ‰€æœ‰æ–¹æ³•éƒ½é€‚ç”¨äºæ‰€æœ‰ç±»å‹ã€‚
// åœ¨è°ƒç”¨ kind å…·ä½“æ–¹æ³•ä¹‹å‰ï¼Œå…ˆä½¿ç”¨ Kind æ–¹æ³•æ‰¾å‡ºç±»å‹çš„ç§ç±»ã€‚å› ä¸ºè°ƒç”¨ä¸€ä¸ªæ–¹æ³•å¦‚æœç±»å‹ä¸åŒ¹é…ä¼šå¯¼è‡´ panic
//
// Type ç±»å‹å€¼æ˜¯å¯ä»¥æ¯”è¾ƒçš„ï¼Œæ¯”å¦‚ç”¨ == æ“ä½œç¬¦ã€‚æ‰€ä»¥å®ƒå¯ä»¥ç”¨åš map çš„ key
// å¦‚æœä¸¤ä¸ª Type å€¼ä»£è¡¨ç›¸åŒçš„ç±»å‹ï¼Œé‚£ä¹ˆå®ƒä»¬ä¸€å®šæ˜¯ç›¸ç­‰çš„ã€‚
type Type interface {
   // Align è¿”å›è¯¥ç±»å‹åœ¨å†…å­˜ä¸­åˆ†é…æ—¶ï¼Œä»¥å­—èŠ‚æ•°ä¸ºå•ä½çš„å­—èŠ‚æ•°
   Align() int
   
   // FieldAlign è¿”å›è¯¥ç±»å‹åœ¨ç»“æ„ä¸­ä½œä¸ºå­—æ®µä½¿ç”¨æ—¶ï¼Œä»¥å­—èŠ‚æ•°ä¸ºå•ä½çš„å­—èŠ‚æ•°
   FieldAlign() int
   
   // Methodè¿™ä¸ªæ–¹æ³•è¿”å›ç±»å‹æ–¹æ³•é›†ä¸­çš„ç¬¬iä¸ªæ–¹æ³•ã€‚
   // å¦‚æœ i ä¸åœ¨[0, NumMethod()]èŒƒå›´å†…ï¼Œå°±ä¼š panicã€‚
   // å¯¹äºéæ¥å£ç±»å‹ T æˆ– *Tï¼Œè¿”å›çš„ Method çš„ Type å’Œ Func å­—æ®µæè¿°äº†ä¸€ä¸ªå‡½æ•°ï¼Œ
   // å…¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¥æ”¶è€…ï¼Œå¹¶ä¸”åªèƒ½è®¿é—®å¯¼å‡ºçš„æ–¹æ³•ã€‚
   // å¯¹äºä¸€ä¸ªæ¥å£ç±»å‹ï¼Œè¿”å›çš„ Method çš„ Type å­—æ®µç»™å‡ºçš„æ˜¯æ–¹æ³•ç­¾åï¼Œæ²¡æœ‰æ¥æ”¶è€…ï¼ŒFuncå­—æ®µä¸ºnilã€‚
   // æ–¹æ³•æ˜¯æŒ‰å­—å…¸åºé¡ºåºæ’åˆ—çš„ã€‚
   Method(int) Method

   // MethodByName è¿”å›ç±»å‹çš„æ–¹æ³•é›†ä¸­å…·æœ‰è¯¥åç§°çš„æ–¹æ³•å’Œä¸€ä¸ªæŒ‡ç¤ºæ˜¯å¦æ‰¾åˆ°è¯¥æ–¹æ³•çš„å¸ƒå°”å€¼ã€‚
   // å¯¹äºéæ¥å£ç±»å‹ T æˆ– *Tï¼Œè¿”å›çš„ Method çš„ Type å’Œ Func å­—æ®µæè¿°äº†ä¸€ä¸ªå‡½æ•°ï¼Œ
   // å…¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¥æ”¶è€…ã€‚
   // å¯¹äºä¸€ä¸ªæ¥å£ç±»å‹ï¼Œè¿”å›çš„ Method çš„ Type å­—æ®µç»™å‡ºçš„æ˜¯æ–¹æ³•ç­¾åï¼Œæ²¡æœ‰æ¥æ”¶è€…ï¼ŒFuncå­—æ®µä¸ºnilã€‚
   MethodByName(string) (Method, bool)

   // NumMethod è¿”å›ä½¿ç”¨ Method å¯ä»¥è®¿é—®çš„æ–¹æ³•æ•°é‡ã€‚
   // å¯¹äºéæ¥å£ç±»å‹ï¼Œå®ƒè¿”å›å¯¼å‡ºæ–¹æ³•çš„æ•°é‡ã€‚
   // å¯¹äºæ¥å£ç±»å‹ï¼Œå®ƒè¿”å›å¯¼å‡ºå’Œæœªå¯¼å‡ºæ–¹æ³•çš„æ•°é‡ã€‚
   NumMethod() int

   // Name è¿”å›å®šä¹‰ç±»å‹åœ¨å…¶åŒ…ä¸­çš„ç±»å‹åç§°ã€‚
   // å¯¹äºå…¶ä»–ï¼ˆæœªå®šä¹‰çš„ï¼‰ç±»å‹ï¼Œå®ƒè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚
   Name() string

   // PkgPath è¿”å›ä¸€ä¸ªå®šä¹‰ç±»å‹çš„åŒ…çš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯å¯¼å…¥è·¯å¾„ï¼Œå¯¼å…¥è·¯å¾„æ˜¯å”¯ä¸€æ ‡è¯†åŒ…çš„ç±»å‹ï¼Œå¦‚ &quot;encoding/base64&quot;ã€‚
   // å¦‚æœç±»å‹æ˜¯é¢„å…ˆå£°æ˜çš„(string, error)æˆ–è€…æ²¡æœ‰å®šä¹‰(*T, struct{}, []intï¼Œæˆ– Aï¼Œå…¶ä¸­ A æ˜¯ä¸€ä¸ªéå®šä¹‰ç±»å‹çš„åˆ«åï¼‰ï¼ŒåŒ…çš„è·¯å¾„å°†æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚
   PkgPath() string

   // Size è¿”å›å­˜å‚¨ç»™å®šç±»å‹çš„å€¼æ‰€éœ€çš„å­—èŠ‚æ•°ã€‚å®ƒç±»ä¼¼äº unsafe.Sizeof.
   Size() uintptr

   // String è¿”å›è¯¥ç±»å‹çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚
   // å­—ç¬¦ä¸²è¡¨ç¤ºæ³•å¯ä»¥ä½¿ç”¨ç¼©çŸ­çš„åŒ…åã€‚
   // (ä¾‹å¦‚ï¼Œä½¿ç”¨ base64 è€Œä¸æ˜¯ &quot;encoding/base64&quot;)å¹¶ä¸”å®ƒå¹¶ä¸èƒ½ä¿è¯ç±»å‹ä¹‹é—´æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœæ˜¯ä¸ºäº†æµ‹è¯•ç±»å‹æ ‡è¯†ï¼Œåº”è¯¥ç›´æ¥æ¯”è¾ƒç±»å‹ Typeã€‚
   String() string

   // Kind è¿”å›è¯¥ç±»å‹çš„å…·ä½“ç§ç±»ã€‚
   Kind() Kind

   // Implements è¡¨ç¤ºè¯¥ç±»å‹æ˜¯å¦å®ç°äº†æ¥å£ç±»å‹ uã€‚
   Implements(u Type) bool

   // AssignableTo è¡¨ç¤ºè¯¥ç±»å‹çš„å€¼æ˜¯å¦å¯ä»¥åˆ†é…ç»™ç±»å‹ uã€‚
   AssignableTo(u Type) bool

   // ConvertibleTo è¡¨ç¤ºè¯¥ç±»å‹çš„å€¼æ˜¯å¦å¯è½¬æ¢ä¸º u ç±»å‹ã€‚
   ConvertibleTo(u Type) bool

   // Comparable è¡¨ç¤ºè¯¥ç±»å‹çš„å€¼æ˜¯å¦å…·æœ‰å¯æ¯”æ€§ã€‚
   Comparable() bool
}
</code></pre>
<p>ä¸‹é¢æ˜¯<strong>æŸäº›ç±»å‹ç‰¹å®š</strong>çš„æ–¹æ³•ï¼Œå¯¹äºè¿™äº›æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„ç±»å‹ä¸å¯¹ï¼Œåˆ™ä¼šÂ <code>panic</code></p>
<pre><code class="language-go">type Type interface {
   // Bits ä»¥ bits ä¸ºå•ä½è¿”å›ç±»å‹çš„å¤§å°ã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸å±äºï¼šsized æˆ–è€… unsized Int, Uint, Float, æˆ–è€… Complexï¼Œä¼š panicã€‚
   Bits() int

   // ChanDir è¿”å›ä¸€ä¸ªé€šé“ç±»å‹çš„æ–¹å‘ã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯ Chanï¼Œä¼š panicã€‚
   ChanDir() ChanDir

   // IsVariadic è¡¨ç¤ºä¸€ä¸ªå‡½æ•°ç±»å‹çš„æœ€ç»ˆè¾“å…¥å‚æ•°æ˜¯å¦ä¸ºä¸€ä¸ª &quot;...&quot; å¯å˜å‚æ•°ã€‚å¦‚æœæ˜¯ï¼Œt.In(t.NumIn() - 1) è¿”å›å‚æ•°çš„éšå¼å®é™…ç±»å‹ []T.
   // æ›´å…·ä½“çš„ï¼Œå¦‚æœ t ä»£è¡¨ func(x int, y ... float64)ï¼Œé‚£ä¹ˆï¼š
   // t.NumIn() == 2
   // t.In(0)æ˜¯ &quot;int&quot; çš„ reflect.Type åå°„ç±»å‹ã€‚
   // t.In(1)æ˜¯ &quot;[]float64&quot; çš„ reflect.Type åå°„ç±»å‹ã€‚
   // t.IsVariadic() == true
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯ Funcï¼ŒIsVariadic ä¼š panic
   IsVariadic() bool

   // Elem è¿”å›ä¸€ä¸ª type çš„å…ƒç´ ç±»å‹ã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯ Arrayã€Chanã€Mapã€Ptr æˆ– Sliceï¼Œå°±ä¼š panic
   Elem() Type

   // Field è¿”å›ä¸€ä¸ªç»“æ„ç±»å‹çš„ç¬¬ i ä¸ªå­—æ®µã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯ Structï¼Œå°±ä¼š panicã€‚
   // å¦‚æœ i ä¸åœ¨ [0, NumField()) èŒƒå›´å†…ä¹Ÿä¼š panicã€‚
   Field(i int) StructField

   // FieldByIndex è¿”å›ç´¢å¼•åºåˆ—å¯¹åº”çš„åµŒå¥—å­—æ®µã€‚å®ƒç›¸å½“äºå¯¹æ¯ä¸€ä¸ª index è°ƒç”¨ Fieldã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯ Structï¼Œå°±ä¼š panicã€‚
   FieldByIndex(index []int) StructField

   // FieldByName è¿”å›ç»™å®šåç§°çš„ç»“æ„å­—æ®µå’Œä¸€ä¸ªè¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°è¯¥å­—æ®µçš„å¸ƒå°”å€¼ã€‚
   FieldByName(name string) (StructField, bool)

   // FieldByNameFunc è¿”å›ä¸€ä¸ªèƒ½æ»¡è¶³ match å‡½æ•°çš„å¸¦æœ‰åç§°çš„ field å­—æ®µã€‚å¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°ã€‚
   FieldByNameFunc(match func(string) bool) (StructField, bool)

   // In è¿”å›å‡½æ•°ç±»å‹çš„ç¬¬ i ä¸ªè¾“å…¥å‚æ•°çš„ç±»å‹ã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯ Func ç±»å‹ä¼š panicã€‚
   // å¦‚æœ i ä¸åœ¨ [0, NumIn()) çš„èŒƒå›´å†…ï¼Œä¼š panicã€‚
   In(i int) Type

   // Key è¿”å›ä¸€ä¸ª map ç±»å‹çš„ key ç±»å‹ã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯ Mapï¼Œä¼š panicã€‚
   Key() Type

   // Len è¿”å›ä¸€ä¸ªæ•°ç»„ç±»å‹çš„é•¿åº¦ã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯ Arrayï¼Œä¼š panicã€‚
   Len() int

   // NumField è¿”å›ä¸€ä¸ªç»“æ„ç±»å‹çš„å­—æ®µæ•°ç›®ã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯ Structï¼Œä¼š panicã€‚
   NumField() int

   // NumIn è¿”å›ä¸€ä¸ªå‡½æ•°ç±»å‹çš„è¾“å…¥å‚æ•°æ•°ã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯Func.NumIn()ï¼Œä¼š panicã€‚
   NumIn() int

   // NumOut è¿”å›ä¸€ä¸ªå‡½æ•°ç±»å‹çš„è¾“å‡ºå‚æ•°æ•°ã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯ Func.NumOut()ï¼Œä¼š panicã€‚
   NumOut() int

   // Out è¿”å›ä¸€ä¸ªå‡½æ•°ç±»å‹çš„ç¬¬ i ä¸ªè¾“å‡ºå‚æ•°çš„ç±»å‹ã€‚
   // å¦‚æœç±»å‹çš„ Kind ä¸æ˜¯ Funcï¼Œä¼š panicã€‚
   // å¦‚æœ i ä¸åœ¨ [0, NumOut()) çš„èŒƒå›´å†…ï¼Œä¼š panicã€‚
   Out(i int) Type
}
</code></pre>
<h3>2.5.1. åˆ›å»ºreflect.Typeçš„æ–¹æ³•</h3>
<p><img src="https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images20250302204355928.png" alt="image.png"></p>
<h2>2.6. è·å–å€¼ä¿¡æ¯reflect.Value</h2>
<p><code>reflect.Value</code> æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå®ƒä»£è¡¨äº†ä¸€ä¸ªå€¼ã€‚ æˆ‘ä»¬ä½¿ç”¨<code>reflect.Value</code>å¯ä»¥å®ç°ä¸€äº›æ¥æ”¶å¤šç§ç±»å‹å‚æ•°çš„å‡½æ•°ï¼Œåˆæˆ–è€…å¯ä»¥è®©æˆ‘ä»¬åœ¨è¿è¡Œæ—¶é’ˆå¯¹å€¼çš„ä¸€äº›ä¿¡æ¯æ¥è¿›è¡Œä¿®æ”¹ã€‚å¸¸å¸¸ç”¨åœ¨æ¥æ”¶ <code>interface{}</code> ç±»å‹å‚æ•°çš„æ–¹æ³•ä¸­ï¼Œå› ä¸ºå‚æ•°æ˜¯æ¥å£ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>reflect.ValueOf</code> æ¥è·å–åˆ°å‚æ•°çš„å€¼ä¿¡æ¯ã€‚ æ¯”å¦‚ç±»å‹ã€å¤§å°ã€ç»“æ„ä½“å­—æ®µã€æ–¹æ³•ç­‰ç­‰ã€‚</p>
<ul>
<li>è®¾ç½®å€¼çš„æ–¹æ³•ï¼š<code>Set*</code>ï¼š<code>Set</code>ã€<code>SetBool</code>ã€<code>SetBytes</code>ã€<code>SetCap</code>ã€<code>SetComplex</code>ã€<code>SetFloat</code>ã€<code>SetInt</code>ã€<code>SetLen</code>ã€<code>SetMapIndex</code>ã€<code>SetPointer</code>ã€<code>SetString</code>ã€<code>SetUint</code>ã€‚é€šè¿‡è¿™ç±»æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹åå°„å€¼çš„å†…å®¹ï¼Œå‰ææ˜¯è¿™ä¸ªåå°„å€¼å¾—æ˜¯åˆé€‚çš„ç±»å‹ã€‚<strong>CanSet è¿”å› true æ‰èƒ½è°ƒç”¨è¿™ç±»æ–¹æ³•</strong></li>
<li>è·å–å€¼çš„æ–¹æ³•ï¼š<code>Interface</code>ã€<code>InterfaceData</code>ã€<code>Bool</code>ã€<code>Bytes</code>ã€<code>Complex</code>ã€<code>Float</code>ã€<code>Int</code>ã€<code>String</code>ã€<code>Uint</code>ã€‚é€šè¿‡è¿™ç±»æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åå°„å€¼çš„å†…å®¹ã€‚å‰ææ˜¯è¿™ä¸ªåå°„å€¼æ˜¯åˆé€‚çš„ç±»å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸èƒ½é€šè¿‡ <code>complex</code> åå°„å€¼æ¥è°ƒç”¨ <code>Int</code> æ–¹æ³•ï¼ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Kind</code> æ¥åˆ¤æ–­ç±»å‹ï¼‰ã€‚</li>
<li>map ç±»å‹çš„æ–¹æ³•ï¼š<code>MapIndex</code>ã€<code>MapKeys</code>ã€<code>MapRange</code>ã€<code>MapSet</code>ã€‚</li>
<li>chan ç±»å‹çš„æ–¹æ³•ï¼š<code>Close</code>ã€<code>Recv</code>ã€<code>Send</code>ã€<code>TryRecv</code>ã€<code>TrySend</code>ã€‚</li>
<li>slice ç±»å‹çš„æ–¹æ³•ï¼š<code>Len</code>ã€<code>Cap</code>ã€<code>Index</code>ã€<code>Slice</code>ã€<code>Slice3</code>ã€‚</li>
<li>struct ç±»å‹çš„æ–¹æ³•ï¼š<code>NumField</code>ã€<code>NumMethod</code>ã€<code>Field</code>ã€<code>FieldByIndex</code>ã€<code>FieldByName</code>ã€<code>FieldByNameFunc</code>ã€‚</li>
<li>åˆ¤æ–­æ˜¯å¦å¯ä»¥è®¾ç½®ä¸ºæŸä¸€ç±»å‹ï¼š<code>CanConvert</code>ã€<code>CanComplex</code>ã€<code>CanFloat</code>ã€<code>CanInt</code>ã€<code>CanInterface</code>ã€<code>CanUint</code>ã€‚</li>
<li>æ–¹æ³•ç±»å‹çš„æ–¹æ³•ï¼š<code>Method</code>ã€<code>MethodByName</code>ã€<code>Call</code>ã€<code>CallSlice</code>ã€‚</li>
<li>åˆ¤æ–­å€¼æ˜¯å¦æœ‰æ•ˆï¼š<code>IsValid</code>ã€‚</li>
<li>åˆ¤æ–­å€¼æ˜¯å¦æ˜¯ <code>nil</code>ï¼š<code>IsNil</code>ã€‚</li>
<li>åˆ¤æ–­å€¼æ˜¯å¦æ˜¯é›¶å€¼ï¼š<code>IsZero</code>ã€‚</li>
<li>åˆ¤æ–­å€¼èƒ½å¦å®¹çº³ä¸‹æŸä¸€ç±»å‹çš„å€¼ï¼š<code>Overflow</code>ã€<code>OverflowComplex</code>ã€<code>OverflowFloat</code>ã€<code>OverflowInt</code>ã€<code>OverflowUint</code>ã€‚</li>
<li>åå°„å€¼æŒ‡é’ˆç›¸å…³çš„æ–¹æ³•ï¼š<code>Addr</code>ï¼ˆ<code>CanAddr</code> ä¸º <code>true</code> æ‰èƒ½è°ƒç”¨ï¼‰ã€<code>UnsafeAddr</code>ã€<code>Pointer</code>ã€<code>UnsafePointer</code>ã€‚</li>
<li>è·å–ç±»å‹ä¿¡æ¯ï¼š<code>Type</code>ã€<code>Kind</code>ã€‚</li>
<li>è·å–æŒ‡å‘å…ƒç´ çš„å€¼ï¼š<code>Elem</code>ã€‚</li>
<li>ç±»å‹è½¬æ¢ï¼š<code>Convert</code>ã€‚</li>
</ul>
<h3>2.6.1. åˆ›å»ºreflect.Valueçš„æ–¹å¼</h3>
<p><img src="https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images20250302204622669.png" alt="image.png"></p>
<h1>3. ç¤ºä¾‹</h1>
<h2>3.1. ç¤ºä¾‹ä¸€</h2>
<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;reflect&quot;
)

func main() {
    var x float64 = 1.2345

    fmt.Println(&quot;==TypeOf==&quot;)
    t := reflect.TypeOf(x)
    fmt.Println(&quot;type: &quot;, t)       // type:  float64
    fmt.Println(&quot;kind:&quot;, t.Kind()) // kind: float64

    fmt.Println(&quot;==ValueOf==&quot;)
    v := reflect.ValueOf(x)
    fmt.Println(&quot;value: &quot;, v)                     // value:  1.2345
    fmt.Println(&quot;type:&quot;, v.Type())                // type:  float64
    fmt.Println(&quot;kind:&quot;, v.Kind())                // kind: float64
    fmt.Println(&quot;value:&quot;, v.Float())              //value: 1.2345
    fmt.Println(v.Interface())                    // 1.2345
    fmt.Printf(&quot;value is %5.2e\n&quot;, v.Interface()) // value is 1.23e+00

    y := v.Interface().(float64)
    fmt.Println(y) // 1.2345

    fmt.Println(&quot;===kind===&quot;)
    type MyInt int
    var m MyInt = 5
    v = reflect.ValueOf(m)
    fmt.Println(&quot;kind:&quot;, v.Kind()) // kind: int
    fmt.Println(&quot;type:&quot;, v.Type()) // type: main.MyInt
}
</code></pre>
<p>ä¸Šé¢çš„ä¾‹å­ï¼Œreflect åŒ…ä¸­ reflect.TypeOf() è¿”å›Typeå’Œ reflect.ValueOf() è¿”å›Valueç±»å‹ éƒ½æœ‰ä¸€ä¸ª Kind() æ–¹æ³•ï¼ŒKind() è¿”å›ä¸€ä¸ªåº•å±‚çš„æ•°æ®ç±»å‹ï¼Œå¦‚ Unitï¼ŒFloat64ï¼ŒSlice, Int ç­‰ã€‚</p>
<p>reflect.ValueOf() è¿”å›çš„ Value ç±»å‹ï¼š</p>
<ul>
<li>å®ƒæœ‰ä¸€ä¸ª Type() æ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ reflect.Value çš„ Type</li>
<li>å®ƒæœ‰è·å– Value ç±»å‹å€¼çš„æ–¹æ³•</li>
<li>å¦‚æœæˆ‘ä»¬çŸ¥é“æ˜¯ float ç±»å‹ï¼Œæ‰€ä»¥ç›´æ¥ç”¨ Float() æ–¹æ³•ã€‚</li>
<li>å¦‚æœä¸çŸ¥é“å…·ä½“ç±»å‹å‘¢ï¼Ÿç”±ä¸Šé¢ä¾‹å­å¯çŸ¥ç”¨ Interface() æ–¹æ³•ï¼Œç„¶ååœ¨è¿›è¡Œç±»å‹æ–­è¨€ v.Interface().(float64) æ¥åˆ¤æ–­è·å–å€¼</li>
</ul>
<p>v.Kind() å’Œ v.Type() åŒºåˆ«ï¼š<br>ä¸Šä¾‹ä¸­ï¼Œåœ¨ type MyInt int é‡Œï¼Œv.Kind() ä¸ v.Type() è¿”å›äº†ä¸åŒçš„ç±»å‹å€¼ï¼ŒKind()è¿”å›çš„æ˜¯ intï¼ŒType() è¿”å›çš„æ˜¯ MyIntã€‚<br>åœ¨ Go ä¸­ï¼Œå¯ä»¥ç”¨typeå…³é”®å­—å®šä¹‰è‡ªå®šä¹‰ç±»å‹</p>
<ul>
<li>Kind()æ–¹æ³•è¿”å›åº•å±‚ç±»å‹ã€‚</li>
<li>æ¯”å¦‚è¿˜æœ‰ç»“æ„ä½“ï¼ŒæŒ‡é’ˆç­‰ç±»å‹ç”¨typeå®šä¹‰çš„ï¼Œé‚£ä¹ˆ Kind() æ–¹æ³•å°±å¯ä»¥è·å–è¿™äº›ç±»å‹çš„åº•å±‚ç±»å‹ã€‚</li>
</ul>
<h2>3.2. ç¤ºä¾‹äºŒ</h2>
<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;reflect&quot;
)

type student struct {
    Name string `json:&quot;name&quot;`
    Age  int    `json:&quot;age&quot; id:&quot;1&quot;`
}

func main() {
    stu := student{
        Name: &quot;hangmeimei&quot;,
        Age:  15,
    }

    valueOfStu := reflect.ValueOf(stu)
    // è·å–structå­—æ®µæ•°é‡
    fmt.Println(&quot;NumFields: &quot;, valueOfStu.NumField())
    // è·å–å­—æ®µ Name çš„å€¼
    fmt.Println(&quot;Name value: &quot;, valueOfStu.Field(0).String(), &quot;, &quot;, valueOfStu.FieldByName(&quot;Name&quot;).String())
    // å­—æ®µç±»å‹
    fmt.Println(&quot;Name type: &quot;, valueOfStu.Field(0).Type())

    typeOfStu := reflect.TypeOf(stu)
    for i := 0; i &lt; typeOfStu.NumField(); i++ {
        // è·å–å­—æ®µå
        name := typeOfStu.Field(i).Name
        fmt.Println(&quot;Field Name: &quot;, name)

        // è·å–tag
        if fieldName, ok := typeOfStu.FieldByName(name); ok {
            tag := fieldName.Tag

            fmt.Println(&quot;tag-&quot;, tag, &quot;, &quot;, &quot;json:&quot;, tag.Get(&quot;json&quot;), &quot;, id&quot;, tag.Get(&quot;id&quot;))
        }
    }
}
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code class="language-text">NumFields:  2
Name value:  hangmeimei ,  hangmeimei
Name type:  string
Field Name:  Name
tag- json:&quot;name&quot; ,  json: name , id 
Field Name:  Age
tag- json:&quot;age&quot; id:&quot;1&quot; ,  json: age , id 1
</code></pre>
<p>è·å–structä¿¡æ¯çš„ä¸€äº›æ–¹æ³•ï¼š</p>
<ul>
<li>NumField() è·å–ç»“æ„ä½“å­—æ®µæ•°é‡</li>
<li>Field(i) å¯ä»¥é€šè¿‡ i å­—æ®µç´¢å¼•æ¥è·å–ç»“æ„ä½“å­—æ®µä¿¡æ¯ï¼Œæ¯”å¦‚ Field(i).Name è·å–å­—æ®µå</li>
<li>FieldByName(name) é€šè¿‡nameè·å–å­—æ®µä¿¡æ¯</li>
</ul>
<h2>3.3. ç¤ºä¾‹ä¸‰</h2>
<p>åå°„è°ƒç”¨æ–¹æ³•</p>
<pre><code class="language-go">package main

import (
    &quot;log&quot;
    &quot;reflect&quot;
)

type PersonBehavior interface {
    SayName()
    SayAge()
}

type Person struct {
    name string
    age  int16
}

func (p Person) SayName() {
    log.Println(p.name)
}

func (p Person) SayAge() {
    log.Println(p.age)
}

func main() {
    var p any = Person{
        name: &quot;lisi&quot;,
        age:  12,
    }

    value := reflect.ValueOf(p)

    method := value.MethodByName(&quot;SayName&quot;)
    if method.IsValid() {
        method.Call(nil)
    }

    for i := range value.NumMethod() {
        method = value.Method(i)
        method.Call(nil)
    }
}
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre><code class="language-text">2025/03/02 12:58:35 lisi
2025/03/02 12:58:35 12
2025/03/02 12:58:35 lisi
</code></pre>
<h1>4. ref</h1>
<p><a href="https://www.cnblogs.com/jiujuan/p/17142703.html">https://www.cnblogs.com/jiujuan/p/17142703.html</a></p>
}
    </section>
</article>
            </div>
        </main>
        <footer class="page-footer">
            <div class="container">
                <p>&copy; 2026 Shinerio's Blog. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script>
        // Theme switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('theme-toggle');
            const body = document.getElementById('theme-body');

            // Check for saved theme preference or respect OS preference
            const savedTheme = localStorage.getItem('theme');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');

            // Set initial theme
            if (savedTheme === 'dark' || (!savedTheme && prefersDarkScheme.matches)) {
                body.setAttribute('data-theme', 'dark');
            } else {
                body.removeAttribute('data-theme'); // light theme
            }

            // Toggle theme function
            function toggleTheme() {
                if (body.getAttribute('data-theme') === 'dark') {
                    body.removeAttribute('data-theme');
                    localStorage.setItem('theme', 'light');
                } else {
                    body.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                }
            }

            // Add event listener to theme toggle button
            themeToggle.addEventListener('click', toggleTheme);

            // Listen for OS theme changes
            prefersDarkScheme.addEventListener('change', function(e) {
                if (!localStorage.getItem('theme')) {
                    if (e.matches) {
                        body.setAttribute('data-theme', 'dark');
                    } else {
                        body.removeAttribute('data-theme');
                    }
                }
            });

            // Search functionality
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const searchResults = document.getElementById('search-results');
            const searchSuggestions = document.getElementById('search-suggestions');
            const searchTypeRadios = document.querySelectorAll('input[name="search-type"]');

            if (searchInput && searchButton) {
                let searchData = null;

                // Load search data
                async function loadSearchData() {
                    try {
                        const response = await fetch('./assets/js/search-data.json');
                        if (response.ok) {
                            searchData = await response.json();
                        } else {
                            console.error('Failed to load search data:', response.status);
                        }
                    } catch (error) {
                        console.error('Error loading search data:', error);
                    }
                }

                // Initialize search data
                loadSearchData();

                // Debounce function to limit search calls
                function debounce(func, wait) {
                    let timeout;
                    return function executedFunction(...args) {
                        const later = () => {
                            clearTimeout(timeout);
                            func(...args);
                        };
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                    };
                }

                // Get selected search type
                function getSelectedSearchType() {
                    const selectedRadio = document.querySelector('input[name="search-type"]:checked');
                    return selectedRadio ? selectedRadio.value : 'all';
                }

                // Perform search
                function performSearch(query) {
                    if (!searchData || !query.trim()) {
                        searchResults.innerHTML = '';
                        searchSuggestions.innerHTML = '';
                        return;
                    }

                    const queryTerms = query.toLowerCase().split(/\s+/).filter(term => term.length > 0);
                    const searchType = getSelectedSearchType();

                    if (queryTerms.length === 0) {
                        searchResults.innerHTML = '';
                        return;
                    }

                    const results = [];

                    // Search through articles
                    searchData.articles.forEach(article => {
                        let score = 0;
                        let snippet = '';

                        // Get content based on search type
                        const lowerTitle = article.title.toLowerCase();
                        const lowerContent = article.content.toLowerCase();
                        const lowerTags = article.tags.join(' ').toLowerCase();

                        queryTerms.forEach(term => {
                            switch(searchType) {
                                case 'title':
                                    // Only title matches count
                                    if (lowerTitle.includes(term)) {
                                        score += 10;
                                    }
                                    break;
                                case 'content':
                                    // Only content matches count (fixed to exclude title matches)
                                    if (lowerContent.includes(term)) {
                                        score += 1;
                                    }
                                    break;
                                case 'all':
                                default:
                                    // Both title and content matches count
                                    if (lowerTitle.includes(term)) {
                                        score += 10;
                                    }
                                    if (lowerContent.includes(term)) {
                                        score += 1;
                                    }
                                    // Tag matches get medium-high score
                                    if (lowerTags.includes(term)) {
                                        score += 5;
                                    }
                                    break;
                            }
                        });

                        if (score > 0) {
                            // Generate snippet based on search type
                            let content = '';

                            if (searchType === 'title') {
                                // For title-only search, show title content
                                content = article.title.substring(0, 200);
                            } else if (searchType === 'content') {
                                // For content-only search, show content excerpt
                                content = article.content.substring(0, 200);
                            } else {
                                // For all search, show content with title as context
                                content = article.content.substring(0, 200);
                            }

                            // Find first occurrence of query term in content for snippet
                            queryTerms.forEach(term => {
                                let searchIn = content.toLowerCase();
                                if (searchType === 'title') {
                                    searchIn = lowerTitle;
                                } else if (searchType === 'content') {
                                    searchIn = lowerContent;
                                }

                                const index = searchIn.indexOf(term);
                                if (index !== -1) {
                                    // Expand snippet around the match
                                    let start, end;
                                    if (searchType === 'title') {
                                        start = Math.max(0, index - 15);
                                        end = Math.min(content.length, index + term.length + 35);
                                    } else {
                                        start = Math.max(0, index - 30);
                                        end = Math.min(content.length, index + term.length + 70);
                                    }

                                    content = (start > 0 ? '...' : '') +
                                              content.substring(start, end) +
                                              (end < (searchType === 'title' ? article.title.length : article.content.length) ? '...' : '');

                                    // Highlight the term in the snippet
                                    const searchContent = searchType === 'title' ? article.title : article.content;
                                    const adjustedIndex = searchType === 'title' ?
                                        Math.min(index, article.title.length - 1) :
                                        Math.min(index, article.content.length - 1);

                                    content = content.replace(
                                        new RegExp(`(${escapeRegExp(term)})`, 'gi'),
                                        '<mark>$1</mark>'
                                    );
                                }
                            });

                            results.push({
                                article: article,
                                score: score,
                                snippet: content
                            });
                        }
                    });

                    // Sort results by score
                    results.sort((a, b) => b.score - a.score);

                    // Display results
                    displaySearchResults(results);
                }

                // Display search results
                function displaySearchResults(results) {
                    if (results.length === 0) {
                        searchResults.innerHTML = '<p class="no-results">æœªæ‰¾åˆ°åŒ¹é…çš„æ–‡ç« </p>';
                        return;
                    }

                    const resultsHTML = results.map(result => `
                        <div class="search-result-item">
                            <h3 class="search-result-title">
                                <a href="./${result.article.slug}.html">${highlightQueryTerms(result.article.title, document.querySelector('#search-input').value)}</a>
                            </h3>
                            <div class="search-result-meta">
                                ${result.article.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                            </div>
                            <p class="search-result-excerpt">${result.snippet}</p>
                        </div>
                    `).join('');

                    searchResults.innerHTML = resultsHTML;
                }

                // Highlight query terms in text
                function highlightQueryTerms(text, query) {
                    if (!query.trim()) return text;

                    const queryTerms = query.split(/\s+/).filter(term => term.length > 0);
                    let highlightedText = text;

                    queryTerms.forEach(term => {
                        const regex = new RegExp(`(${escapeRegExp(term)})`, 'gi');
                        highlightedText = highlightedText.replace(regex, '<mark>$1</mark>');
                    });

                    return highlightedText;
                }

                // Escape special regex characters
                function escapeRegExp(string) {
                    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                }

                // Event listener for search button
                searchButton.addEventListener('click', function() {
                    const query = searchInput.value;
                    performSearch(query);
                });

                // Event listener for Enter key
                searchInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        const query = searchInput.value;
                        performSearch(query);
                    }
                });

                // Add debounced input handler for live search (optional)
                const debouncedSearch = debounce(function() {
                    const query = searchInput.value;
                    performSearch(query);
                }, 300);

                searchInput.addEventListener('input', debouncedSearch);

                // Add event listeners for search type radios
                searchTypeRadios.forEach(radio => {
                    radio.addEventListener('change', function() {
                        const query = searchInput.value;
                        if (query.trim()) {
                            performSearch(query);
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>