# 1. LB实例
- 可用区：选择部署的可用区列表，可用区越多，价格越贵
- 应用型和网络型：可组合选择购买应用型和网络型，组合不同，收费不同
- 网络配置：
	- 所属VPC
	- 网络类型：ipv4、ipv6，可组合选择，或都不选（只提供公网接入）；选择ipv4后，可提供私网IP接入的私网负载均衡；选择ipv6后（需要子网支持IPv6），支持来自私网IPv6流量，绑定带宽包后同时公网的ipv6流量。
	- 前端子网：仅网络类型包括ipv4后，需要选择前端子网，用于分配私网vip
	- 后端子网：由于分配ENI，访问后端服务器，后端服务器需要放通ACL和安全组
	- 公网访问：可以为ELB绑定公网IP，提供公网负载均衡
# 2. listener（代表一种业务）
一个ELB下可以用多个Listener，一个listener只能属于一个ELB，不同listener的协议和端口组合需要不同，监听器由如下元素构造
- 前端协议：TCP/UDP/HTTP/HTTPS
- 监听端口：可以选择单端口或全端口监听
- 访问控制：支持基于地址组的白名单或黑名单访问控制
- 获取客户端IP
- 获取监听器端口号：X-Forwarded-Port
- 获取客户端请求端口号：X-Forwarded-For-Port
- 获取LB实例绑定的EIP：X-Forwarded-ELB-IP
- 是否开启数据压缩
- 会话超时时间：如果在超时时间内一直没有访问请求，负载均衡会关闭当前连接，直到下一次请求到来时再重新建立新的连接。
- 请求超时时间：客户端向负载均衡发起请求，如果在超时时间内客户端没有完成整个请求的传输，负载均衡将放弃等待关闭连接。
- 响应超时时间：负载均衡向后端服务器发起请求，如果超时时间内接收请求的后端服务器无响应，负载均衡会向其他后端服务器重试请求。如果重试期间后端服务器一直没有响应，则负载均衡会给客户端返回HTTP 504错误码。
- az可控的每秒新建和并发连接

一个listener可以关联多个后端服务器组，一个后端服务器组也能被多个listener关联，通过listener上配置策略实现。

可以组合多个条件，转发只特定后端服务器组，转发时支持重写域名、路径和查找字符串。
- 域名
- 路径
- HTTP METHOD
- HTTP HEADER
- 过滤条件：如name=zhangsan
- 源网段
![image.png](https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images20250109231541797.png)

# 3. 后端服务器组
后端服务器组中包含多个后端服务器，可以设置如下属性：
- 分配策略：多个负载到多个后端
- 会话保持：四层协议的会话保持转发支持源IP地址类型，即来自同一IP地址的访问请求转发到同一台后端服务器上。  七层协议的会话保持转发支持负载均衡器cookie和应用程序 cookie类型。用户可根据自身需求选择相应的会话保持方式来分配用户访问流量，提升负载均衡能力。  如果您需要从专线、VPN、云连接访问ELB，请您使用源IP负载均衡算法代替会话保持功能。
- 慢启动：负载均衡器向该模式下的后端服务器线性增加请求分配权重，当配置的慢启动持续时间期限结束后，负载均衡器向后端服务器发送完整的请求比例，此后本次添加的后端服务器退出慢启动模式。
![image.png](https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images20250109232335100.png)

## 3.1. 健康检查
![image.png](https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images20250109232041779.png)

## 3.2. 每个后端服务器的权重和业务端口
![image.png](https://shinerio.oss-cn-beijing.aliyuncs.com/blog_images20250109232015712.png)
