# 1. 公网NAT
# 2. 特性
- 支持一键全通
- snat只允许修改eip
- [监控与运维](https://help.aliyun.com/document_detail/111908.html?spm=a2c4g.121142.0.0.75fb22e4e4V93t)
- 支持按量计费和带宽包
### 2.1.1. NIS（Network Intelligence Service）
支持实例级别的一键诊断，可以检测实例的配置与运行状态，并能根据诊断的异常项提供智能修复建议。诊断内容主要包括：连通性诊断、配置诊断、容量超限诊断和费用诊断，同时可以查看历史诊断详情。
- **实例诊断**：检测网元实例配置和运行状态，一键诊断异常智能修复
- **路径分析**： 端到端连通和性能分析，网络拓扑和互访关系呈现
- **流量分析**：监测各场景流量异常，及时告警并分析根因

| **诊断项分类**   | **具体诊断项及说明**                                                                                                                                                                                                                                                                                                     |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **连通性诊断**   | - **限速丢包**：检查公网NAT网关实例是否因超规格使用而导致限速丢包。<br>    <br>- **SNAT源端口分配失败检查**：检查公网NAT网关实例的SNAT源端口分配是否成功。                                                                                                                                                               |
| **配置诊断**     | - **路由缺失检查**：检查VPC内是否存在指向公网NAT网关实例的路由。<br>    <br>- **实例状态检查**：检查公网NAT网关实例的状态。<br>    <br>- **NAT策略配置检查**：检查公网NAT网关实例是否已经配置SNAT和DNAT规则。<br>    <br>- **EIP绑定状态检查**：检查公网NAT网关实例是否已绑定弹性公网IP（Elastic IP Address，简称EIP）。 |
| **容量超限诊断** | - **NAT实例流量处理率检测**：检查公网NAT网关实例的流量处理率是否正常。<br>    <br>- **NAT实例并发连接利用率监测**：检查公网NAT网关实例并发连接利用率是否正常。                                                                                                                                                           |
| **费用诊断**     | - **欠费到期预警**：检查公网NAT网关实例是否处于到期前15天的预警状态。<br>    <br>- **欠费状态告警**：检查公网NAT网关实例是否已经欠费。                                                                                                                                                                                   |
## 2.2. 性能
公网NAT网关默认的吞吐能力是5 Gbps，可根据使用量弹性扩大至15 Gbps，最大可联系客户经理扩容至100 Gbps。

| 指标   | 新建连接速率 | 并发连接数 | 处理流量                 |
| ---- | ------ | ----- | -------------------- |
| 默认指标 | 10万    | 200万  | 5 Gbps，可自动弹性至15 Gbps |

## 2.3. 配额
### 2.3.1. 网关
- 一个vpc支持5个网关
- 一个NAT网关支持绑定20个EIP
- 一个公网NAT实例支持20个标签。
### 2.3.2. SNAT
- 一个公网NAT网关默认支持创建40条SNAT条目。
- 一个SNAT条目默认支持关联64个EIP，且不支持提升配额。
### 2.3.3. DNAT
- 一个网关100条规则
## 2.4. 其他
### 2.4.1. snat多eip选择
指定多个EIP配置至SNAT IP地址池时，业务连接会通过哈希算法分配到多个EIP，由于每个连接的流量不同，可能会出现多EIP业务流量不均匀的情况，建议您将每个EIP加入到同一个共享带宽中以避免单EIP带宽达到上限导致业务受损。
### 2.4.2. IP占用情况
创建网关默认占用一个私网IP，绑定第一个EIP的时候不额外占用私网IP，绑定第二个EIP的时候额外再占用一个私网IP。
> 从2022年09月19日起，新创建的公网NAT网关绑定一个EIP时将占用NAT网关所在交换机的一个私网IP （已有NAT网关实例不受影响），请确保NAT网关所在交换机内私网IP地址充足，如果NAT网关所在的交换机没有可用的空闲私网地址时，将无法绑定新的EIP。

# 3. 私网NAT
## 3.1. 性能
|指标|新建连接速率|并发连接数|处理流量|
|---|---|---|---|
|默认指标|10万|200万|5 Gbps，可自动弹性至15 Gbps|
## 3.2. 配额限制
### 3.2.1. 实例限制
- 一个VPC限制5个
- 限制50个地址段，每个地址段50个地址
- 一个网关支持20个标签
### 3.2.2. snat
- 一个网关40个
- 一个snat规则仅支持绑定1个natIp
### 3.2.3. dnat
- 一个网关100个
## 3.3. 其他
### 3.3.1. NAT IP段
- 默认创建一个实例所在子网网段的地址段
- 网关口IP可以用作NAT IP
- 不会占用其他VPC的IP，NAT IP段在网关侧管理，需要对端配置路由下一跳指向连接网关（ER/Peering等）。
### 3.3.2. [升级普通型公网NAT网关至增强型公网NAT网关](https://help.aliyun.com/document_detail/198983.html?spm=a2c4g.187955.0.0.6abd6319FXy3jB)
### 3.3.3. DDoS攻击防护
NAT网关默认开启DDoS基础防护能力，提供不超过5 Gbps的基础DDoS防护能力。所有来自互联网的流量都要先经过云盾再到达NAT网关实例，云盾会针对常见的攻击进行清洗过滤。
### 3.3.4. 网关和主机要在两个子网，绑定不同路由表
### 3.3.5. 使用本vpc的ip作为nat ip
客户端所在子网路由表配置目的地址为对端的送到私网NAT网关；网关所在子网绑定自定义路由表，设置目的地址为对端的送个CEN（ER），peering等。
![image.png](https://shinerio.oss-cn-beijing.aliyuncs.com/obsidian/202310042200814.png)
![image.png](https://shinerio.oss-cn-beijing.aliyuncs.com/obsidian/202310042202314.png)
### 3.3.6. 使用自定义ip作为nat ip
需要通过路由表的方式将自定义ip段指向nat，自定义网段仅支持10，192.168，172.16网段