<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <title>Github Oauth - Shinerio's Blog</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/style.css">
    <link rel="stylesheet" href="./assets/css/style-addition.css">
    <meta property="og:title" content="Github Oauth">
<meta property="og:description" content="â–â–›â–ˆâ–ˆâ–ˆâ–œâ–Œ Claude Code v2.1.34 â–â–œâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›â–˜ Opus 4.6 Â· Claude API â–˜â–˜ â–â– C:\workspace\code\shinerio.github.io > 1. æ–‡ç« è¯¦æƒ…é¡µï¼Œç‚¹å‡»åˆ’è¯åï¼Œç‚¹å‡»ä½¿ç”¨githubç™»å½•ï¼Œé¡µé¢ç›´æ¥404ï¼Œéœ€è¦ä¿®å¤ 2. åº•...">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2026-02-14T05:38:37.051Z">
<meta property="article:author" content="shinerio">
<link rel="stylesheet" id="hljs-light" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
<link rel="stylesheet" id="hljs-dark" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" disabled>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" defer></script>
<script src="assets/js/code-enhance.js" defer></script>
<script src="assets/js/image-enhance.js" defer></script>
<!-- Text Selection Comment (åˆ’è¯è¯„è®º) -->
<link rel="stylesheet" href="assets/css/text-selection-comment.css">
<script>
  window.textSelectionCommentConfig = {
    repo: 'shinerio/shinerio.github.io',
    label: 'select-annotation',
    articleSlug: 'github-oauth',
    clientId: 'Ov23li65mtWdX973c2zm',
    oauthProxyUrl: 'https://github-oauth-proxy.jstxshinerio.workers.dev'
  };
</script>
<script src="assets/js/text-selection-comment.js" defer></script>
</head>
<body class="article-page" id="theme-body">
    <div class="page-wrapper">
        <div class="sidebar-overlay"></div>
        <header class="page-header">
            <div class="container">
                <nav class="page-nav">
                    <div class="nav-links">
                        <button class="sidebar-toggle" aria-label="Toggle sidebar">
                            <span class="sidebar-toggle-icon"></span>
                        </button>
                        <a href="index.html" class="nav-link ">Home</a>
                        <a href="articles.html" class="nav-link ">Articles</a>
                        <a href="search.html" class="nav-link ">Search</a>
                        <a href="todo.html" class="nav-link ">TODO</a>
                    </div>
                    <div class="nav-actions">
                        <button id="theme-toggle" aria-label="Toggle dark mode" class="theme-toggle-btn">
                            <span class="sun-icon">â˜€ï¸</span>
                            <span class="moon-icon">ğŸŒ™</span>
                        </button>
                    </div>
                </nav>
            </div>
        </header>
        <main class="page-main">
            <div class="container">
                <article>
    <header>
        <h1>Github Oauth</h1>
        <time datetime="2026-02-14T05:38:37.051Z">2026å¹´2æœˆ14æ—¥</time>
        <div class="tags">
            
        </div>
    </header>
    <section class="content">
        <p>â–â–›â–ˆâ–ˆâ–ˆâ–œâ–Œ   Claude Code v2.1.34<br>â–â–œâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›â–˜  Opus 4.6 Â· Claude API<br>  â–˜â–˜ â–â–    C:\workspace\code\shinerio.github.io</p>
<blockquote>
<ol>
<li>æ–‡ç« è¯¦æƒ…é¡µï¼Œç‚¹å‡»åˆ’è¯åï¼Œç‚¹å‡»ä½¿ç”¨githubç™»å½•ï¼Œé¡µé¢ç›´æ¥404ï¼Œéœ€è¦ä¿®å¤  2.<br>  åº•éƒ¨è¯„è®ºåŠŸèƒ½å’ŒTODOé¡µé¢éƒ½å·²ç»å®ç°äº†è®¤è¯åŠŸèƒ½ï¼Œèƒ½å¦æœç”¨</li>
</ol>
</blockquote>
<p>â— Explore(Explore text selection comment auth)<br>  â¿ Â Done (21 tool uses Â· 84.3k tokens Â· 3m 52s)</p>
<p>â— Let me read the key files to understand the exact implementation details.</p>
<p>â— Read 2 files (ctrl+o to expand)</p>
<p>â— Now let me look at the TODO page&#39;s OAuth implementation and the config file.</p>
<p>â— Read 3 files (ctrl+o to expand)</p>
<p>â— Now I have a clear picture. Here&#39;s the problem and solution:</p>
<p>  Root cause: The text selection comment feature uses OAuth Authorization Code<br>  Flow that redirects to /oauth-callback.html after GitHub auth, but this page<br>  doesn&#39;t exist in the codebase -- hence the 404.</p>
<p>  Solution: Switch to Device Flow (same approach as TODO page), reusing the same<br>   Cloudflare Worker proxy (oauthProxyUrl). This eliminates the need for a<br>  callback page entirely.</p>
<p>  Let me implement the fix.</p>
<p>â— Now let me make all the config-level changes in parallel.</p>
<p>â— Update(src\types\index.ts)<br>  â¿ Â Added 1 line<br>      14      enabled: boolean;          // æ˜¯å¦å¯ç”¨åˆ’è¯è¯„è®º<br>      15      label?: string;            // ç”¨äºåˆ’è¯è¯„è®ºçš„ GitHub labelï¼Œ<br>          é»˜è®¤ &#39;text-annotation&#39;<br>      16      oauthClientId?: string;    // GitHub OAuth App Client ID<br>      17 +    oauthProxyUrl?: string;    // Cloudflare Worker URL for OAu<br>         +th proxy<br>      18    };<br>      19  }<br>      20  </p>
<p>â— Update(blog.config.json)<br>  â¿ Â Added 2 lines, removed 1 line<br>      20      &quot;annotation&quot;: {<br>      21        &quot;enabled&quot;: true,<br>      22        &quot;label&quot;: &quot;select-annotation&quot;,<br>      23 -      &quot;oauthClientId&quot;: &quot;Ov23li65mtWdX973c2zm&quot;<br>      23 +      &quot;oauthClientId&quot;: &quot;Ov23li65mtWdX973c2zm&quot;,<br>      24 +      &quot;oauthProxyUrl&quot;: &quot;<a href="https://github-oauth-proxy.jstxshinerio">https://github-oauth-proxy.jstxshinerio</a><br>         +.workers.dev&quot;<br>      25      }<br>      26    },<br>      27    &quot;todo&quot;: {</p>
<p>â— Update(src\core\SiteGenerator.ts)<br>  â¿ Â Added 3 lines, removed 1 line<br>      761      const repo = config.comments.repo;<br>      762      const annotationLabel = config.comments.annotation.label |<br>           | &#39;text-annotation&#39;;<br>      763      const oauthClientId = config.comments.annotation.oauthClie<br>           ntId || &#39;&#39;;<br>      764 +    const oauthProxyUrl = config.comments.annotation.oauthProx<br>          +yUrl || &#39;&#39;;<br>      765<br>      766      return <code>       767  &lt;!-- Text Selection Comment (åˆ’è¯è¯„è®º) --&gt;      ...       771      repo: &#39;${repo}&#39;,       772      label: &#39;${annotationLabel}&#39;,       773      articleSlug: &#39;${articleSlug}&#39;,       773 -    clientId: &#39;${oauthClientId}&#39;                                     774 +    clientId: &#39;${oauthClientId}&#39;,                                    775 +    oauthProxyUrl: &#39;${oauthProxyUrl}&#39;                                776    };       777  &lt;/script&gt;       778  &lt;script src=&quot;assets/js/text-selection-comment.js&quot; defer&gt;&lt;/scri            pt&gt;</code>;</p>
<p>â— Now let me rewrite the auth flow in text-selection-comment.js to use Device<br>  Flow.</p>
<p>â— Update(templates\assets\js\text-selection-comment.js)<br>  â¿ Â Added 182 lines, removed 11 lines<br>      334    }<br>      335<br>      336    /**<br>      337 -   * Handle GitHub auth click<br>      337 +   * Handle GitHub auth click - starts Device Flow<br>      338     <em>/<br>      339    function handleAuthClick() {<br>      340 -    // Generate OAuth state<br>      341 -    const stateParam = btoa(Math.random().toString(36)).substr<br>          -ing(0, 16);<br>      342 -    sessionStorage.setItem(&#39;tsc_oauth_state&#39;, stateParam);<br>      340 +    hidePopover();<br>      341 +    startDeviceFlow();<br>      342 +  }<br>      343<br>      344 -    // Store current URL to redirect back<br>      345 -    sessionStorage.setItem(&#39;tsc_redirect_url&#39;, window.location<br>          -.href);<br>      344 +  /</em>*<br>      345 +   * Create the device flow modal<br>      346 +   <em>/<br>      347 +  function createDeviceModal() {<br>      348 +    if (state.deviceModal) return;<br>      349<br>      347 -    // Build OAuth URL<br>      350 +    state.deviceModal = document.createElement(&#39;div&#39;);<br>      351 +    state.deviceModal.className = &#39;tsc-device-modal&#39;;<br>      352 +    state.deviceModal.innerHTML = <code>                                 353 +      &lt;div class=&quot;tsc-device-modal-content&quot;&gt;                         354 +        &lt;div class=&quot;tsc-popover-header&quot;&gt;                             355 +          &lt;span class=&quot;tsc-popover-title&quot;&gt;GitHub æˆæƒ&lt;/span&gt;         356 +          &lt;button class=&quot;tsc-popover-close tsc-device-cancel&quot;            +title=&quot;å…³é—­&quot;&gt;${ICONS.close}&lt;/button&gt;                                 357 +        &lt;/div&gt;                                                       358 +        &lt;div class=&quot;tsc-device-body&quot;&gt;                                359 +          &lt;p class=&quot;tsc-device-instruction&quot;&gt;è¯·è®¿é—®ä»¥ä¸‹é“¾æ¥å¹¶è¾“           +å…¥æˆæƒç ï¼š&lt;/p&gt;                                                       360 +          &lt;a class=&quot;tsc-device-link&quot; href=&quot;https://github.com/           +login/device&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;github           +.com/login/device&lt;/a&gt;                                                361 +          &lt;div class=&quot;tsc-device-code&quot;&gt;&lt;/div&gt;                        362 +          &lt;button class=&quot;tsc-device-copy-btn&quot;&gt;å¤åˆ¶æˆæƒç &lt;/butt           +on&gt;                                                                  363 +          &lt;p class=&quot;tsc-device-status&quot;&gt;ç­‰å¾…æˆæƒä¸­...&lt;/p&gt;             364 +        &lt;/div&gt;                                                       365 +      &lt;/div&gt;                                                         366 +   </code>;<br>      367 +    document.body.appendChild(state.deviceModal);<br>      368 +<br>      369 +    // Bind close/cancel<br>      370 +    state.deviceModal.querySelector(&#39;.tsc-device-cancel&#39;).addE<br>          +ventListener(&#39;click&#39;, cancelDeviceFlow);<br>      371 +    state.deviceModal.addEventListener(&#39;click&#39;, (e) =&gt; {<br>      372 +      if (e.target === state.deviceModal) cancelDeviceFlow();<br>      373 +    });<br>      374 +<br>      375 +    // Bind copy button<br>      376 +    state.deviceModal.querySelector(&#39;.tsc-device-copy-btn&#39;).ad<br>          +dEventListener(&#39;click&#39;, () =&gt; {<br>      377 +      const code = state.deviceModal.querySelector(&#39;.tsc-devic<br>          +e-code&#39;).textContent;<br>      378 +      navigator.clipboard.writeText(code).then(() =&gt; {<br>      379 +        const btn = state.deviceModal.querySelector(&#39;.tsc-devi<br>          +ce-copy-btn&#39;);<br>      380 +        btn.textContent = &#39;å·²å¤åˆ¶!&#39;;<br>      381 +        setTimeout(() =&gt; { btn.textContent = &#39;å¤åˆ¶æˆæƒç &#39;; },<br>          +2000);<br>      382 +      }).catch(() =&gt; {});<br>      383 +    });<br>      384 +  }<br>      385 +<br>      386 +  /</em>*<br>      387 +   * Start OAuth Device Flow<br>      388 +   <em>/<br>      389 +  async function startDeviceFlow() {<br>      390      const clientId = CONFIG.clientId || &#39;&#39;;<br>      349 -    const redirectUri = encodeURIComponent(window.location.ori<br>          -gin + &#39;/oauth-callback.html&#39;);<br>      350 -    const scope = encodeURIComponent(&#39;public_repo&#39;);<br>      391 +    const proxyUrl = CONFIG.oauthProxyUrl || &#39;&#39;;<br>      392<br>      352 -    const authUrl = <code>https://github.com/login/oauth/authorize?           -client_id=${clientId}&amp;redirect_uri=${redirectUri}&amp;scope=${scop           -e}&amp;state=${stateParam}</code>;<br>      393 +    if (!clientId || !proxyUrl) {<br>      394 +      console.error(&#39;[TSC] OAuth not configured: missing clien<br>          +tId or oauthProxyUrl&#39;);<br>      395 +      alert(&#39;OAuth æœªé…ç½®ï¼Œæ— æ³•ç™»å½•&#39;);<br>      396 +      return;<br>      397 +    }<br>      398<br>      354 -    window.location.href = authUrl;<br>      399 +    createDeviceModal();<br>      400 +<br>      401 +    try {<br>      402 +      const resp = await fetch(proxyUrl + &#39;/device/code&#39;, {<br>      403 +        method: &#39;POST&#39;,<br>      404 +        headers: { &#39;Content-Type&#39;: &#39;application/json&#39; },<br>      405 +        body: JSON.stringify({<br>      406 +          client_id: clientId,<br>      407 +          scope: &#39;public_repo&#39;<br>      408 +        })<br>      409 +      });<br>      410 +<br>      411 +      if (!resp.ok) {<br>      412 +        const errorText = await resp.text();<br>      413 +        console.error(&#39;[TSC] Device flow error:&#39;, errorText);<br>      414 +        alert(&#39;å¯åŠ¨æˆæƒå¤±è´¥ï¼Œè¯·é‡è¯•&#39;);<br>      415 +        return;<br>      416 +      }<br>      417 +<br>      418 +      const data = await resp.json();<br>      419 +<br>      420 +      if (data.error) {<br>      421 +        console.error(&#39;[TSC] GitHub error:&#39;, data);<br>      422 +        alert(&#39;æˆæƒé”™è¯¯: &#39; + (data.error_description || data.e<br>          +rror));<br>      423 +        return;<br>      424 +      }<br>      425 +<br>      426 +      // Show modal with device code<br>      427 +      state.deviceModal.querySelector(&#39;.tsc-device-code&#39;).text<br>          +Content = data.user_code;<br>      428 +      const linkEl = state.deviceModal.querySelector(&#39;.tsc-dev<br>          +ice-link&#39;);<br>      429 +      linkEl.href = data.verification_uri || &#39;<a href="https://github.c">https://github.c</a><br>          +om/login/device&#39;;<br>      430 +      state.deviceModal.querySelector(&#39;.tsc-device-status&#39;).te<br>          +xtContent = &#39;ç­‰å¾…æˆæƒä¸­...&#39;;<br>      431 +      state.deviceModal.classList.add(&#39;visible&#39;);<br>      432 +<br>      433 +      // Start polling for token<br>      434 +      pollForToken(data.device_code, data.interval || 5);<br>      435 +    } catch (e) {<br>      436 +      console.error(&#39;[TSC] Device flow exception:&#39;, e);<br>      437 +      alert(&#39;æˆæƒè¯·æ±‚å¤±è´¥: &#39; + e.message);<br>      438 +    }<br>      439    }<br>      440<br>      441    /</em>*<br>      442 +   * Poll for access token during Device Flow<br>      443 +   <em>/<br>      444 +  function pollForToken(deviceCode, interval) {<br>      445 +    if (state.devicePollTimer) clearInterval(state.devicePollT<br>          +imer);<br>      446 +<br>      447 +    const clientId = CONFIG.clientId || &#39;&#39;;<br>      448 +    const proxyUrl = CONFIG.oauthProxyUrl || &#39;&#39;;<br>      449 +<br>      450 +    state.devicePollTimer = setInterval(async () =&gt; {<br>      451 +      try {<br>      452 +        const resp = await fetch(proxyUrl + &#39;/access_token&#39;, {<br>      453 +          method: &#39;POST&#39;,<br>      454 +          headers: { &#39;Content-Type&#39;: &#39;application/json&#39; },<br>      455 +          body: JSON.stringify({<br>      456 +            client_id: clientId,<br>      457 +            device_code: deviceCode,<br>      458 +            grant_type: &#39;urn:ietf:params:oauth:grant-type:devi<br>          +ce_code&#39;<br>      459 +          })<br>      460 +        });<br>      461 +<br>      462 +        if (!resp.ok) return;<br>      463 +<br>      464 +        const data = await resp.json();<br>      465 +<br>      466 +        if (data.access_token) {<br>      467 +          clearInterval(state.devicePollTimer);<br>      468 +          state.devicePollTimer = null;<br>      469 +<br>      470 +          // Fetch user info and save auth state<br>      471 +          try {<br>      472 +            const userResp = await fetch(&#39;<a href="https://api.github.c">https://api.github.c</a><br>          +om/user&#39;, {<br>      473 +              headers: { &#39;Authorization&#39;: &#39;token &#39; + data.acce<br>          +ss_token }<br>      474 +            });<br>      475 +            if (userResp.ok) {<br>      476 +              const user = await userResp.json();<br>      477 +              saveAuthState(data.access_token, {<br>      478 +                login: user.login,<br>      479 +                avatarUrl: user.avatar_url,<br>      480 +                id: user.id<br>      481 +              });<br>      482 +            } else {<br>      483 +              saveAuthState(data.access_token, null);<br>      484 +            }<br>      485 +          } catch (e) {<br>      486 +            saveAuthState(data.access_token, null);<br>      487 +          }<br>      488 +<br>      489 +          // Hide modal<br>      490 +          state.deviceModal.classList.remove(&#39;visible&#39;);<br>      491 +<br>      492 +          // If we had a pending selection, show the comment p<br>          +opover<br>      493 +          if (state.currentSelection) {<br>      494 +            showCommentPopover();<br>      495 +          }<br>      496 +        } else if (data.error === &#39;authorization_pending&#39;) {<br>      497 +          // Keep waiting<br>      498 +        } else if (data.error === &#39;slow_down&#39;) {<br>      499 +          state.deviceModal.querySelector(&#39;.tsc-device-status&#39;<br>          +).textContent = &#39;è¯·ç¨å€™...&#39;;<br>      500 +        } else if (data.error === &#39;expired_token&#39;) {<br>      501 +          clearInterval(state.devicePollTimer);<br>      502 +          state.devicePollTimer = null;<br>      503 +          state.deviceModal.querySelector(&#39;.tsc-device-status&#39;<br>          +).textContent = &#39;æˆæƒç å·²è¿‡æœŸï¼Œè¯·é‡æ–°æ“ä½œ&#39;;<br>      504 +        } else if (data.error === &#39;access_denied&#39;) {<br>      505 +          clearInterval(state.devicePollTimer);<br>      506 +          state.devicePollTimer = null;<br>      507 +          state.deviceModal.querySelector(&#39;.tsc-device-status&#39;<br>          +).textContent = &#39;æˆæƒè¢«æ‹’ç»&#39;;<br>      508 +        }<br>      509 +      } catch (e) {<br>      510 +        console.error(&#39;[TSC] Token polling error:&#39;, e);<br>      511 +      }<br>      512 +    }, (interval + 1) * 1000);<br>      513 +  }<br>      514 +<br>      515 +  /</em>*<br>      516 +   * Cancel the device flow<br>      517 +   <em>/<br>      518 +  function cancelDeviceFlow() {<br>      519 +    if (state.devicePollTimer) {<br>      520 +      clearInterval(state.devicePollTimer);<br>      521 +      state.devicePollTimer = null;<br>      522 +    }<br>      523 +    if (state.deviceModal) {<br>      524 +      state.deviceModal.classList.remove(&#39;visible&#39;);<br>      525 +    }<br>      526 +  }<br>      527 +<br>      528 +  /</em>*<br>      529     * Show comment input popover<br>      530     */<br>      531    function showCommentPopover() {</p>
<p>â— Now I need to add deviceModal and devicePollTimer to the state, and add<br>  oauthProxyUrl to CONFIG reading.</p>
<p>â— Update(templates\assets\js\text-selection-comment.js)<br>  â¿ Â Added 2 lines<br>      41      popover: null,<br>      42      tooltip: null,<br>      43      articleSlug: null,<br>      44 +    deviceModal: null,<br>      45 +    devicePollTimer: null,<br>      46    };<br>      47<br>      48    // Icons (SVG)</p>
<p>â— Now add oauthProxyUrl to the CONFIG initialization from the page config.</p>
<p>â— Update(templates\assets\js\text-selection-comment.js)<br>  â¿ Â Added 2 lines<br>      62      const pageConfig = window.textSelectionCommentConfig || {};<br>      63      CONFIG.repo = pageConfig.repo || CONFIG.repo;<br>      64      CONFIG.label = pageConfig.label || CONFIG.label;<br>      65 +    CONFIG.clientId = pageConfig.clientId || &#39;&#39;;<br>      66 +    CONFIG.oauthProxyUrl = pageConfig.oauthProxyUrl || &#39;&#39;;<br>      67      state.articleSlug = pageConfig.articleSlug || getArticleSlu<br>          g();<br>      68<br>      69      if (!CONFIG.repo) {</p>
<p>â— Now let me read the CSS file and add the device modal styles.</p>
<p>â— Read 1 file (ctrl+o to expand)</p>
<p>â— Update(templates\assets\css\text-selection-comment.css)<br>  â¿ Â Added 91 lines<br>      351    height: 18px;<br>      352  }<br>      353<br>      354 +/* Device Flow Modal <em>/<br>      355 +.tsc-device-modal {<br>      356 +  display: none;<br>      357 +  position: fixed;<br>      358 +  top: 0;<br>      359 +  left: 0;<br>      360 +  right: 0;<br>      361 +  bottom: 0;<br>      362 +  z-index: 1003;<br>      363 +  align-items: center;<br>      364 +  justify-content: center;<br>      365 +  background: rgba(0, 0, 0, 0.5);<br>      366 +  backdrop-filter: blur(2px);<br>      367 +}<br>      368 +<br>      369 +.tsc-device-modal.visible {<br>      370 +  display: flex;<br>      371 +}<br>      372 +<br>      373 +.tsc-device-modal-content {<br>      374 +  width: 360px;<br>      375 +  max-width: calc(100vw - 40px);<br>      376 +  padding: 20px;<br>      377 +  background: var(--tsc-popover-bg);<br>      378 +  border: 1px solid var(--tsc-popover-border);<br>      379 +  border-radius: 12px;<br>      380 +  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);<br>      381 +}<br>      382 +<br>      383 +.tsc-device-body {<br>      384 +  text-align: center;<br>      385 +  padding: 8px 0;<br>      386 +}<br>      387 +<br>      388 +.tsc-device-instruction {<br>      389 +  font-size: 14px;<br>      390 +  color: var(--color-text-secondary, <span class="tag">#586069</span>);<br>      391 +  margin-bottom: 12px;<br>      392 +}<br>      393 +<br>      394 +.tsc-device-link {<br>      395 +  display: inline-block;<br>      396 +  font-size: 14px;<br>      397 +  color: var(--color-primary, <span class="tag">#0366d6</span>);<br>      398 +  text-decoration: none;<br>      399 +  margin-bottom: 16px;<br>      400 +}<br>      401 +<br>      402 +.tsc-device-link:hover {<br>      403 +  text-decoration: underline;<br>      404 +}<br>      405 +<br>      406 +.tsc-device-code {<br>      407 +  font-family: &#39;SFMono-Regular&#39;, Consolas, &#39;Liberation Mono&#39;,<br>          +Menlo, monospace;<br>      408 +  font-size: 28px;<br>      409 +  font-weight: 700;<br>      410 +  letter-spacing: 4px;<br>      411 +  color: var(--color-text-primary, <span class="tag">#24292e</span>);<br>      412 +  background: var(--color-bg-secondary, <span class="tag">#f6f8fa</span>);<br>      413 +  border: 1px solid var(--color-border, <span class="tag">#e1e4e8</span>);<br>      414 +  border-radius: 8px;<br>      415 +  padding: 12px 20px;<br>      416 +  margin-bottom: 12px;<br>      417 +  user-select: all;<br>      418 +}<br>      419 +<br>      420 +.tsc-device-copy-btn {<br>      421 +  display: inline-flex;<br>      422 +  align-items: center;<br>      423 +  justify-content: center;<br>      424 +  padding: 6px 14px;<br>      425 +  font-size: 13px;<br>      426 +  font-weight: 500;<br>      427 +  color: var(--color-text-secondary, <span class="tag">#586069</span>);<br>      428 +  background: transparent;<br>      429 +  border: 1px solid var(--color-border, <span class="tag">#e1e4e8</span>);<br>      430 +  border-radius: 6px;<br>      431 +  cursor: pointer;<br>      432 +  transition: background-color 0.2s ease;<br>      433 +  margin-bottom: 16px;<br>      434 +}<br>      435 +<br>      436 +.tsc-device-copy-btn:hover {<br>      437 +  background-color: var(--color-bg-secondary, <span class="tag">#f6f8fa</span>);<br>      438 +}<br>      439 +<br>      440 +.tsc-device-status {<br>      441 +  font-size: 13px;<br>      442 +  color: var(--tsc-text-muted);<br>      443 +}<br>      444 +<br>      445  /</em> Mobile adaptations */<br>      446  @media (max-width: 768px) {<br>      447    .tsc-toolbar {</p>
<p>â— Now add the device modal to print styles so it doesn&#39;t show in print.</p>
<p>â— Update(templates\assets\css\text-selection-comment.css)<br>  â¿ Â Added 1 line<br>      469    .tsc-toolbar,<br>      470    .tsc-popover,<br>      471    .tsc-tooltip,<br>      472 +  .tsc-device-modal,<br>      473    tsc-mark {<br>      474      display: none !important;<br>      475    }</p>
<p>â— Let me verify the changes build correctly.</p>
<p>â— Bash(npm run build 2&gt;&amp;1)<br>  â¿ Â &gt; <a href="mailto:obsidian-blog-generator@1.0.0">obsidian-blog-generator@1.0.0</a> build<br>     &gt; tsc<br>  â¿ Â (timeout 30s)</p>
<p>â— Build succeeds. Let me verify the final state of the changed files.</p>
<p>â— Read 1 file (ctrl+o to expand)</p>
<p>â— The implementation looks correct. Here&#39;s a summary of all the changes made:</p>
<hr>
<p>  é—®é¢˜åˆ†æ</p>
<p>  404 åŸå› ï¼šåˆ’è¯è¯„è®ºçš„ handleAuthClick() ä½¿ç”¨ Authorization Code<br>  Flowï¼Œå°†ç”¨æˆ·é‡å®šå‘åˆ° GitHub æˆæƒåï¼Œå›è°ƒåˆ°<br>  /oauth-callback.htmlï¼Œä½†è¯¥é¡µé¢ä¸å­˜åœ¨ï¼Œå¯¼è‡´ 404ã€‚</p>
<p>  ä¿®å¤æ–¹æ¡ˆ</p>
<p>  å°†åˆ’è¯è¯„è®ºçš„è®¤è¯æ–¹å¼ä» Authorization Code Flow æ”¹ä¸º Device Flowï¼Œå¤ç”¨ TODO<br>  é¡µé¢å·²ç»éªŒè¯é€šè¿‡çš„ Cloudflare Worker ä»£ç†ï¼ˆoauthProxyUrlï¼‰ï¼Œå®Œå…¨æ¶ˆé™¤å¯¹<br>  oauth-callback.html çš„ä¾èµ–ã€‚</p>
<p>  ä¿®æ”¹çš„æ–‡ä»¶</p>
<ol>
<li>src/types/index.ts</li>
</ol>
<ul>
<li>CommentsConfig.annotation æ–°å¢ oauthProxyUrl?: string å­—æ®µ</li>
</ul>
<ol start="2">
<li>blog.config.json</li>
</ol>
<ul>
<li>comments.annotation æ–°å¢ oauthProxyUrlï¼Œå€¼ä¸ TODO é…ç½®å…±äº«åŒä¸€ä¸ª Cloudflare<br>  Worker åœ°å€</li>
</ul>
<ol start="3">
<li>src/core/SiteGenerator.ts</li>
</ol>
<ul>
<li>generateTextSelectionCommentHead() å°† oauthProxyUrl æ³¨å…¥åˆ°<br>  window.textSelectionCommentConfig</li>
</ul>
<ol start="4">
<li>templates/assets/js/text-selection-comment.js</li>
</ol>
<ul>
<li>ä» window.textSelectionCommentConfig è¯»å– clientId å’Œ oauthProxyUrl</li>
<li>handleAuthClick() æ”¹ä¸ºè°ƒç”¨ startDeviceFlow() è€Œéé‡å®šå‘åˆ° GitHub OAuth</li>
<li>æ–°å¢ createDeviceModal() - åˆ›å»ºæˆæƒç å±•ç¤ºå¼¹çª—</li>
<li>æ–°å¢ startDeviceFlow() - é€šè¿‡ Cloudflare Worker è·å– device code</li>
<li>æ–°å¢ pollForToken() - è½®è¯¢ç­‰å¾…ç”¨æˆ·å®Œæˆæˆæƒï¼Œè·å– access token</li>
<li>æ–°å¢ cancelDeviceFlow() - å–æ¶ˆæˆæƒæµç¨‹</li>
<li>æˆæƒæˆåŠŸåè‡ªåŠ¨è·å–ç”¨æˆ·ä¿¡æ¯å¹¶ä¿å­˜ï¼Œå¦‚æœæœ‰å¾…æäº¤çš„é€‰æ‹©æ–‡æœ¬åˆ™è‡ªåŠ¨å¼¹å‡ºè¯„è®ºæ¡†</li>
</ul>
<ol start="5">
<li>templates/assets/css/text-selection-comment.css</li>
</ol>
<ul>
<li>æ–°å¢ Device Flow å¼¹çª—æ ·å¼ï¼ˆ.tsc-device-modalã€.tsc-device-code ç­‰ï¼‰</li>
<li>æ”¯æŒæ·±è‰²/æµ…è‰²ä¸»é¢˜</li>
<li>æ‰“å°æ—¶éšè—å¼¹çª—</li>
</ul>
<p>  ç”¨æˆ·æ“ä½œæµç¨‹ï¼ˆä¿®å¤åï¼‰</p>
<ol>
<li>é€‰æ‹©æ–‡ç« ä¸­çš„æ–‡å­— â†’ å‡ºç°è¯„è®ºæŒ‰é’®</li>
<li>ç‚¹å‡»è¯„è®ºæŒ‰é’® â†’ å¼¹å‡ºç™»å½•æç¤º</li>
<li>ç‚¹å‡»ã€Œä½¿ç”¨ GitHub ç™»å½•ã€â†’ å¼¹å‡ºæˆæƒç å¼¹çª—ï¼ˆéè·³è½¬é¡µé¢ï¼‰</li>
<li>ç”¨æˆ·è®¿é—® github.com/login/device å¹¶è¾“å…¥æˆæƒç </li>
<li>æˆæƒå®Œæˆåè‡ªåŠ¨è·å– tokenï¼Œå¼¹å‡ºè¯„è®ºè¾“å…¥æ¡†</li>
</ol>
<p>âœ» Cogitated for 8m 14s</p>
<p>â— Background command &quot;grep -r &quot;oauth&quot; &quot;C:\workspace\code\shinerio.github.io&quot;<br>--include=&quot;<em>.ts&quot; --include=&quot;</em>.js&quot; --include=&quot;*.html&quot; 2&gt;/dev/null | grep -v<br>node_modules | grep -v dist | head -40&quot; completed (exit code 0)</p>
<p>â— The changes are complete. Let me know if you&#39;d like to review anything or if<br>  you want me to build and deploy the site.</p>
<blockquote>
<p>è¯„è®ºåï¼Œç‚¹å‡»æäº¤ï¼Œçœ‹ä¸Šå»æ²¡æœ‰æ•ˆæœ </p>
</blockquote>
<p>â— Let me check the submit flow. I suspect the issue is that<br>  state.currentSelection gets cleared when the user interacts with the popover<br>  textarea.</p>
<p>â— Read 1 file (ctrl+o to expand)</p>
<p>â— Found the bug. Here&#39;s what happens:</p>
<ol>
<li>User selects text â†’ state.currentSelection is stored</li>
<li>User clicks comment button â†’ popover opens with textarea</li>
<li>User clicks/types in the textarea â†’ browser clears the text selection</li>
<li>handleMouseUp/handleSelectionChange fires â†’ checkSelection() runs</li>
<li>Selection is now empty â†’ state.currentSelection = null</li>
<li>User clicks submit â†’ if (!state.currentSelection) is true â†’ silently hides<br>  popover, does nothing</li>
</ol>
<p>  The fix is to not clear state.currentSelection when the popover is open.</p>
<p>â— Update(templates\assets\js\text-selection-comment.js)<br>  â¿ Â Added 10 lines, removed 2 lines<br>      223     * Check current text selection and show/hide toolbar<br>      224     */<br>      225    function checkSelection() {<br>      226 +    // Don&#39;t clear selection while popover or device modal is<br>          +visible (user is interacting with them)<br>      227 +    const popoverVisible = state.popover &amp;&amp; state.popover.clas<br>          +sList.contains(&#39;visible&#39;);<br>      228 +    const deviceModalVisible = state.deviceModal &amp;&amp; state.devi<br>          +ceModal.classList.contains(&#39;visible&#39;);<br>      229 +<br>      230      const selection = window.getSelection();<br>      231      const text = selection.toString().trim();<br>      232<br>     ...<br>      234      const contentEl = document.querySelector(CONFIG.contentSel<br>           ector);<br>      235      if (!contentEl || text.length === 0) {<br>      236        hideToolbar();<br>      233 -      state.currentSelection = null;<br>      237 +      if (!popoverVisible &amp;&amp; !deviceModalVisible) {<br>      238 +        state.currentSelection = null;<br>      239 +      }<br>      240        return;<br>      241      }<br>      242<br>     ...<br>      244      const range = selection.getRangeAt(0);<br>      245      if (!contentEl.contains(range.commonAncestorContainer)) {<br>      246        hideToolbar();<br>      241 -      state.currentSelection = null;<br>      247 +      if (!popoverVisible &amp;&amp; !deviceModalVisible) {<br>      248 +        state.currentSelection = null;<br>      249 +      }<br>      250        return;<br>      251      }<br>      252  </p>
<p>â— Now let me verify the build still passes.</p>
<p>â— Bash(npm run build 2&gt;&amp;1)<br>  â¿ Â &gt; <a href="mailto:obsidian-blog-generator@1.0.0">obsidian-blog-generator@1.0.0</a> build<br>     &gt; tsc<br>  â¿ Â (timeout 30s)</p>
<p>â— Build passes. The fix is straightforward: checkSelection() now checks whether<br>  the popover or device modal is visible before clearing state.currentSelection.<br>   This way, when the user clicks on the textarea to type their comment, the<br>  original text selection data is preserved and available when they click<br>  submit.</p>
<p>âœ» SautÃ©ed for 56s</p>
<blockquote>
<p>æ‚¬æµ®è¯„è®ºæ¡†ï¼Œå¢åŠ ä¸€ä¸ªç‚¹å‡»å¯ä»¥ç›´æ¥è·³è½¬github issuesçš„åŠŸèƒ½ </p>
</blockquote>
<p>â— Read 1 file (ctrl+o to expand)</p>
<p>â— æ¯æ¡è¯„è®ºåŠ è½½æ—¶å·²ç»å­˜äº† _urlï¼ˆGitHub issue comment çš„é“¾æ¥ï¼‰ï¼Œç›´æ¥åœ¨ tooltip<br>  é‡ŒåŠ ä¸€ä¸ªè·³è½¬é“¾æ¥å³å¯ã€‚</p>
<p>â— Update(templates\assets\js\text-selection-comment.js)<br>  â¿ Â Added 4 lines, removed 1 line<br>      1036      const dateStr = date.toLocaleDateString(&#39;zh-CN&#39;);<br>      1037<br>      1038      state.tooltip.innerHTML = <code>      1039 -      &lt;div class=&quot;tsc-tooltip-author&quot;&gt;${escapeHtml(comment.au            -thor || &#39;åŒ¿å&#39;)}&lt;/div&gt;                                              1039 +      &lt;div class=&quot;tsc-tooltip-header&quot;&gt;                              1040 +        &lt;div class=&quot;tsc-tooltip-author&quot;&gt;${escapeHtml(comment.            +author || &#39;åŒ¿å&#39;)}&lt;/div&gt;                                            1041 +        ${comment._url ?</code>&lt;a class=&quot;tsc-tooltip-github-link&quot;<br>           +href=&quot;${comment._url}&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferr<br>           +er&quot; title=&quot;åœ¨ GitHub ä¸ŠæŸ¥çœ‹&quot;&gt;${ICONS.github}</a><code>: &#39;&#39;}             1042 +      &lt;/div&gt;                                                        1043        &lt;div class=&quot;tsc-tooltip-date&quot;&gt;${dateStr}&lt;/div&gt;       1044        &lt;div class=&quot;tsc-tooltip-comment&quot;&gt;${escapeHtml(comment.c             omment)}&lt;/div&gt;       1045     </code>;</p>
<p>â— Tooltip ç›®å‰æ˜¯ pointer-events:<br>  noneï¼ˆé¼ æ ‡ç©¿é€ï¼‰ï¼Œéœ€è¦æ”¹ä¸ºå¯äº¤äº’ï¼ŒåŒæ—¶è°ƒæ•´éšè—é€»è¾‘é¿å…é¼ æ ‡ç§»åˆ° tooltip<br>  æ—¶ç«‹åˆ»æ¶ˆå¤±ã€‚</p>
<p>â— Read 1 file (ctrl+o to expand)</p>
<p>â— Update(templates\assets\css\text-selection-comment.css)<br>  â¿ Â Added 1 line<br>      245  .tsc-tooltip.visible {<br>      246    opacity: 1;<br>      247    transform: translateY(0);<br>      248 +  pointer-events: auto;<br>      249  }<br>      250<br>      251  .tsc-tooltip::before {</p>
<p>â— Now add styles for the tooltip header and the GitHub link.</p>
<p>â— Update(templates\assets\css\text-selection-comment.css)<br>  â¿ Â Added 29 lines, removed 1 line<br>      261    border-top: 6px solid var(--tsc-tooltip-bg);<br>      262  }<br>      263<br>      264 +.tsc-tooltip-header {<br>      265 +  display: flex;<br>      266 +  align-items: center;<br>      267 +  justify-content: space-between;<br>      268 +  margin-bottom: 4px;<br>      269 +}<br>      270 +<br>      271  .tsc-tooltip-author {<br>      272    font-weight: 600;<br>      266 -  margin-bottom: 4px;<br>      273  }<br>      274<br>      275 +.tsc-tooltip-github-link {<br>      276 +  display: flex;<br>      277 +  align-items: center;<br>      278 +  justify-content: center;<br>      279 +  width: 20px;<br>      280 +  height: 20px;<br>      281 +  color: var(--tsc-tooltip-text);<br>      282 +  opacity: 0.6;<br>      283 +  transition: opacity 0.2s ease;<br>      284 +  flex-shrink: 0;<br>      285 +  margin-left: 8px;<br>      286 +}<br>      287 +<br>      288 +.tsc-tooltip-github-link:hover {<br>      289 +  opacity: 1;<br>      290 +}<br>      291 +<br>      292 +.tsc-tooltip-github-link svg {<br>      293 +  width: 16px;<br>      294 +  height: 16px;<br>      295 +}<br>      296 +<br>      297  .tsc-tooltip-date {<br>      298    font-size: 11px;<br>      299    opacity: 0.8;</p>
<p>â— Now update the JS to handle tooltip hover â€” keep tooltip visible when the<br>  mouse moves from the mark to the tooltip itself.</p>
<p>â— Read 1 file (ctrl+o to expand)</p>
<p>â— Update(templates\assets\js\text-selection-comment.js)<br>  â¿ Â Added 6 lines, removed 4 lines<br>      1067    }<br>      1068<br>      1069    /**<br>      1070 -   * Hide tooltip<br>      1070 +   * Hide tooltip with delay to allow mouse to move to toolti<br>           +p<br>      1071     <em>/<br>      1072    function hideTooltip() {<br>      1073 -    if (state.tooltip) {<br>      1074 -      state.tooltip.classList.remove(&#39;visible&#39;);<br>      1075 -    }<br>      1073 +    state.tooltipHideTimer = setTimeout(() =&gt; {<br>      1074 +      if (state.tooltip) {<br>      1075 +        state.tooltip.classList.remove(&#39;visible&#39;);<br>      1076 +      }<br>      1077 +    }, 150);<br>      1078    }<br>      1079<br>      1080    /</em>*</p>
<p>â— Now add tooltip hover listeners in the createTooltip function to cancel the<br>  hide timer when hovering the tooltip, and hide when leaving.</p>
<p>â— Read 1 file (ctrl+o to expand)</p>
<p>â— Update(templates\assets\js\text-selection-comment.js)<br>  â¿ Â Added 8 lines<br>      178      state.tooltip = document.createElement(&#39;div&#39;);<br>      179      state.tooltip.className = &#39;tsc-tooltip&#39;;<br>      180      document.body.appendChild(state.tooltip);<br>      181 +<br>      182 +    // Keep tooltip visible when mouse enters it (for clicking<br>          + the GitHub link)<br>      183 +    state.tooltip.addEventListener(&#39;mouseenter&#39;, () =&gt; {<br>      184 +      clearTimeout(state.tooltipHideTimer);<br>      185 +    });<br>      186 +    state.tooltip.addEventListener(&#39;mouseleave&#39;, () =&gt; {<br>      187 +      state.tooltip.classList.remove(&#39;visible&#39;);<br>      188 +    });<br>      189    }<br>      190<br>      191    /**</p>
<p>â— Also need to cancel the hide timer when re-entering a mark (in showTooltip).</p>
<p>â— Read 1 file (ctrl+o to expand)</p>
<p>â— Update(templates\assets\js\text-selection-comment.js)<br>  â¿ Â Added 1 line<br>      1037     * Show tooltip for a comment<br>      1038     */<br>      1039    function showTooltip(e, comment) {<br>      1040 +    clearTimeout(state.tooltipHideTimer);<br>      1041      const mark = e.target;<br>      1042      const rect = mark.getBoundingClientRect();<br>      1043  </p>
<p>â— Add tooltipHideTimer to state initialization.</p>
<p>â— Update(templates\assets\js\text-selection-comment.js)<br>  â¿ Â Added 1 line<br>      43      articleSlug: null,<br>      44      deviceModal: null,<br>      45      devicePollTimer: null,<br>      46 +    tooltipHideTimer: null,<br>      47    };<br>      48<br>      49    // Icons (SVG)</p>
<p>â— Let me verify the build.</p>
<p>â— Bash(npm run build 2&gt;&amp;1)<br>  â¿ Â &gt; <a href="mailto:obsidian-blog-generator@1.0.0">obsidian-blog-generator@1.0.0</a> build<br>     &gt; tsc<br>  â¿ Â (timeout 30s)</p>
<p>â— Done.æ”¹åŠ¨ç‚¹ï¼š</p>
<ol>
<li>Tooltip å†…å®¹ â€” æ ‡é¢˜è¡Œå³ä¾§æ–°å¢ GitHub å›¾æ ‡é“¾æ¥ï¼Œç‚¹å‡»ç›´æ¥è·³è½¬åˆ°å¯¹åº”çš„ GitHub<br>  Issue Comment é¡µé¢</li>
<li>Tooltip å¯äº¤äº’ â€” visible çŠ¶æ€ä¸‹ pointer-events: autoï¼Œé“¾æ¥å¯ç‚¹å‡»</li>
<li>å»¶è¿Ÿéšè— â€” é¼ æ ‡ç¦»å¼€é«˜äº®æ–‡å­—æ—¶å»¶è¿Ÿ 150ms å†éšè—<br>  tooltipï¼Œè®©ç”¨æˆ·æœ‰æ—¶é—´å°†é¼ æ ‡ç§»åˆ° tooltip ä¸Šï¼›é¼ æ ‡è¿›å…¥ tooltip åå–æ¶ˆéšè—ï¼Œç¦»å¼€<br>  tooltip åæ‰çœŸæ­£éšè—</li>
</ol>
<p>âœ» Worked for 1m 53s</p>
<blockquote>
<p>/shinerio-code-plugin:gitacp </p>
</blockquote>
<p>â— Let me first analyze what we did in this conversation:</p>
<ol>
<li>Fixed the 404 issue with text selection comment GitHub login by switching<br>  from Authorization Code Flow to Device Flow</li>
<li>Fixed the bug where state.currentSelection was being cleared when user<br>  interacts with the popover textarea</li>
<li>Added a GitHub link to the tooltip for jumping to the GitHub issue</li>
</ol>
<p>  Let me generate the summary and title, then check/create the changelog file,<br>  and execute git commands.</p>
<p>  Title: åˆ’è¯è¯„è®ºåŠŸèƒ½ä¿®å¤ä¸å¢å¼º<br>  Summary:</p>
<ul>
<li>ä¿®å¤åˆ’è¯è¯„è®ºGitHubç™»å½•404é—®é¢˜ï¼šå°†OAuthè®¤è¯æ–¹å¼ä»Authorization Code<br>  Flowæ”¹ä¸ºDevice Flowï¼Œå¤ç”¨TODOé¡µé¢çš„Cloudflare Workerä»£ç†</li>
<li>ä¿®å¤è¯„è®ºæäº¤æ— æ•ˆçš„é—®é¢˜ï¼šé˜²æ­¢popover/device modalå¯è§æ—¶æ¸…é™¤currentSelection</li>
<li>æ‚¬æµ®è¯„è®ºæ¡†æ–°å¢GitHub Issueè·³è½¬é“¾æ¥ï¼Œtooltipæ”¹ä¸ºå¯äº¤äº’ï¼ˆå»¶è¿Ÿéšè—ï¼‰</li>
<li>é…ç½®å±‚æ–°å¢oauthProxyUrlå­—æ®µï¼ˆtypesã€blog.config.jsonã€SiteGeneratoræ³¨å…¥ï¼‰</li>
</ul>
<p>  Let me check if the changelog file exists.</p>
<p>  Let me analyze the changes and prepare the commit.</p>
<p>â— Bash(git -C &quot;C:\workspace\code\shinerio.github.io&quot; status)<br>  â¿ Â On branch master<br>     Your branch is ahead of &#39;origin/master&#39; by 1 commit.<br>       (use &quot;git push&quot; to publish your local commits)<br>     â€¦ +16 lines (ctrl+o to expand)</p>
<p>â— Bash(git -C &quot;C:\workspace\code\shinerio.github.io&quot; diff --stat)<br>  â¿  README.md                                          | 60 ++++++++++++++<br>    ++++++<br>     blog.config.json                                   | 12 +++-<br>    â€¦ +8 lines (ctrl+o to expand)</p>
<p>â— Searched for 1 pattern, read 1 file (ctrl+o to expand)</p>
<p>â— Bash(git -C &quot;C:\workspace\code\shinerio.github.io&quot; log --oneline -5)<br>  â¿ Â 0f8e2fa comment<br>     bba30e6 image<br>     c5ecd08 ä¿®å¤ä»£ç å—æ ·å¼ï¼šåŠ è½½é™„åŠ CSSä¸æ¶ˆé™¤åŒè¾¹æ¡†<br>     â€¦ +2 lines (ctrl+o to expand)</p>
<p>â— Update(changelog\change_202602.md)<br>  â¿ Â Added 4 lines<br>      1 +## åˆ’è¯è¯„è®ºåŠŸèƒ½ä¿®å¤ä¸å¢å¼º<br>      2 +date: 2026-02-14<br>      3 +ä¿®å¤åˆ’è¯è¯„è®ºGitHubç™»å½•404é—®é¢˜ï¼šå°†OAuthè®¤è¯æ–¹å¼ä»Authorization Co<br>        +de Flowæ”¹ä¸ºDevice Flowï¼Œå¤ç”¨TODOé¡µé¢å·²æœ‰çš„Cloudflare Workerä»£ç†<br>        +ï¼ˆoauthProxyUrlï¼‰ï¼Œå½»åº•æ¶ˆé™¤å¯¹ä¸å­˜åœ¨çš„oauth-callback.htmlé¡µé¢çš„ä¾<br>        +èµ–ã€‚ä¿®å¤è¯„è®ºæäº¤æ— æ•ˆçš„é—®é¢˜ï¼šå½“popoveræˆ–device modalå¯è§æ—¶ä¸å†æ¸…<br>        +é™¤currentSelectionï¼Œç¡®ä¿ç”¨æˆ·åœ¨è¾“å…¥æ¡†ä¸­äº¤äº’åä»èƒ½æ­£å¸¸æäº¤è¯„è®ºã€‚æ‚¬<br>        +æµ®è¯„è®ºæ¡†æ–°å¢GitHub Issueè·³è½¬é“¾æ¥ï¼ˆGitHubå›¾æ ‡ï¼‰ï¼Œtooltipæ”¹ä¸ºå¯äº¤<br>        +äº’æ¨¡å¼å¹¶å¢åŠ 150mså»¶è¿Ÿéšè—ï¼Œæ–¹ä¾¿ç”¨æˆ·ç‚¹å‡»é“¾æ¥ã€‚é…ç½®å±‚æ–°å¢oauthProx<br>        +yUrlå­—æ®µï¼ˆtypeså®šä¹‰ã€blog.config.jsonã€SiteGeneratoré¡µé¢æ³¨å…¥ï¼‰ã€‚<br>      4 +<br>      5  ## ä¿®å¤ä»£ç å—æ ·å¼ï¼šåŠ è½½é™„åŠ CSSä¸æ¶ˆé™¤åŒè¾¹æ¡†<br>      6  date: 2026-02-13<br>      7  åœ¨layout.htmlä¸­å¼•å…¥style-addition.cssï¼Œä½¿è¯­è¨€badgeå®šä½ï¼ˆå·¦ä¸Šè§’ï¼‰<br>         ã€å¤åˆ¶æŒ‰é’®å®šä½ï¼ˆå³ä¸Šè§’ï¼‰åŠhoveræ˜¾éšè¡Œä¸ºç”Ÿæ•ˆã€‚åŒæ—¶åœ¨style.cssçš„pr<br>         e codeè§„åˆ™ä¸­æ·»åŠ border: noneï¼Œæ¶ˆé™¤preä¸å†…éƒ¨codeå…ƒç´ çš„åŒè¾¹æ¡†é—®é¢˜<br>         ã€‚</p>
<p>â— Bash(cd &quot;C:\workspace\code\shinerio.github.io&quot; &amp;&amp; git add -A &amp;&amp; git commit -m<br>      &quot;åˆ’è¯è¯„è®ºåŠŸèƒ½ä¿®å¤ä¸å¢å¼ºâ€¦)<br>  â¿ Â [master 63f51be] åˆ’è¯è¯„è®ºåŠŸèƒ½ä¿®å¤ä¸å¢å¼º<br>      8 files changed, 1826 insertions(+), 34 deletions(-)<br>      create mode 100644 templates/assets/css/text-selection-comment.css<br>     â€¦ +10 lines (ctrl+o to expand)</p>
<p>â— Bash(cd &quot;C:\workspace\code\shinerio.github.io&quot; &amp;&amp; git push)<br>  â¿ Â To github.com:shinerio/shinerio.github.io.git<br>        bba30e6..63f51be  master -&gt; master<br>  â¿ Â (timeout 30s)</p>
<p>â— å·²å®Œæˆ git addã€commitã€pushï¼š</p>
<ul>
<li>commit: 63f51be åˆ’è¯è¯„è®ºåŠŸèƒ½ä¿®å¤ä¸å¢å¼º</li>
<li>changelog: å·²å†™å…¥ changelog/change_202602.md</li>
<li>push: å·²æ¨é€è‡³ origin/master</li>
</ul>
<p>âœ» Worked for 1m 5s</p>
<blockquote>
<p>device flowå’Œcode flowåŠŸèƒ½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆæ–‡ç« åº•éƒ¨çš„è¯„è®ºåŠŸèƒ½çš„è®¤è¯å’Œ<br>  åˆ’è¯è¯„è®ºå’ŒTODOé¡µé¢çš„ä¸ä¸€æ ·                                                </p>
</blockquote>
<p>â— Device Flow vs Authorization Code Flow<br>  Column 1: æµç¨‹<br>  Authorization Code Flow: è·³è½¬ GitHub æˆæƒé¡µ â†’ å›è°ƒåˆ°ä½ çš„ç½‘ç«™ â†’ ç”¨ code æ¢<br>  token<br>  Device Flow: æ˜¾ç¤ºä¸€ä¸ªæˆæƒç  â†’ ç”¨æˆ·å» github.com/login/device è¾“å…¥ â†’ è½®è¯¢è·å–<br>    token<br>  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>  Column 1: éœ€è¦å›è°ƒé¡µ<br>  Authorization Code Flow: éœ€è¦ï¼ˆ/oauth-callback.htmlï¼‰<br>  Device Flow: ä¸éœ€è¦<br>  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>  Column 1: éœ€è¦åç«¯<br>  Authorization Code Flow: éœ€è¦ï¼ˆcode æ¢ token æ—¶å¿…é¡»å¸¦<br>    client_secretï¼Œä¸èƒ½æš´éœ²åœ¨å‰ç«¯ï¼‰<br>  Device Flow: ä¸éœ€è¦ client_secretï¼ˆGitHub Device Flow è®¾è®¡ä¸Šå°±æ”¯æŒå…¬å¼€å®¢æˆ·ç«¯ï¼‰<br>  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>  Column 1: ç”¨æˆ·ä½“éªŒ<br>  Authorization Code Flow: æ›´æµç•…ï¼Œä¸€æ¬¡è·³è½¬å³å®Œæˆ<br>  Device Flow: éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å»å¦ä¸€ä¸ªé¡µé¢è¾“å…¥ç <br>  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>  Column 1: é€‚ç”¨åœºæ™¯<br>  Authorization Code Flow: æœ‰åç«¯çš„ Web åº”ç”¨<br>  Device Flow: CLI å·¥å…·ã€IoT è®¾å¤‡ã€çº¯é™æ€ç«™ç‚¹<br>  Authorization Code Flow 404 çš„æ ¹æœ¬åŸå› ï¼šå®ƒéœ€è¦ä¸€ä¸ªå›è°ƒé¡µæ¥æ¥æ”¶ GitHub è¿”å›çš„<br>  codeï¼Œè€Œä½ çš„ç«™æ˜¯ çº¯é™æ€ç«™ï¼ˆGitHub<br>  Pagesï¼‰ï¼Œä¹‹å‰æ²¡æœ‰åˆ›å»ºè¿™ä¸ªé¡µé¢ï¼Œä¹Ÿæ²¡æœ‰åç«¯æ¥å®Œæˆ code â†’ token çš„äº¤æ¢ï¼ˆéœ€è¦<br>  client_secretï¼‰ã€‚</p>
<p>  ä¸‰ç§è®¤è¯æ–¹å¼ä¸ºä»€ä¹ˆä¸ä¸€æ ·</p>
<ol>
<li>æ–‡ç« åº•éƒ¨è¯„è®ºï¼ˆUtterancesï¼‰</li>
</ol>
<p>  Utterances æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚å®ƒé€šè¿‡ <script> æ ‡ç­¾åµŒå…¥ä¸€ä¸ª<br>  iframeï¼Œæ‰€æœ‰è®¤è¯é€»è¾‘éƒ½åœ¨ Utterances è‡ªå·±çš„æœåŠ¡å™¨ä¸Šå®Œæˆï¼š</p>
<p>  ç”¨æˆ·ç‚¹å‡»ç™»å½• â†’ è·³è½¬åˆ° utteranc.es çš„åç«¯ â†’ GitHub OAuth â†’ utteranc.es åç«¯ç”¨<br>  client_secret æ¢ token â†’ å†™å…¥ iframe</p>
<p>  Utterances æœ‰è‡ªå·±çš„åç«¯æœåŠ¡å™¨ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç”¨ Authorization Code<br>  Flowã€‚ä½ ä¸éœ€è¦ç®¡å®ƒçš„è®¤è¯ï¼Œå®ƒå…¨éƒ¨è‡ªå·±å¤„ç†ã€‚</p>
<ol start="2">
<li>TODO é¡µé¢ & åˆ’è¯è¯„è®º</li>
</ol>
<p>  è¿™ä¸¤ä¸ªæ˜¯ä½ è‡ªå·±å®ç°çš„åŠŸèƒ½ï¼Œè¿è¡Œåœ¨çº¯é™æ€ç«™ä¸Šï¼Œæ²¡æœ‰åç«¯ã€‚æ‰€ä»¥ï¼š</p>
<ul>
<li>ä¸èƒ½ç”¨ Authorization Code Flowï¼ˆæ²¡æœ‰åç«¯æŒæœ‰ client_secretï¼‰</li>
<li>ç”¨ Device Flow + Cloudflare Worker ä»£ç†ï¼ˆWorker æŒæœ‰ secretï¼Œä»£ç†è½¬å‘è¯·æ±‚åˆ°<br>  GitHubï¼‰</li>
</ul>
<p>  æ€»ç»“<br>  åŠŸèƒ½: åº•éƒ¨è¯„è®º (Utterances)<br>  è®¤è¯æ–¹å¼: Authorization Code Flowï¼ˆç”± Utterances åç«¯å®Œæˆï¼‰<br>  åŸå› : ç¬¬ä¸‰æ–¹æœåŠ¡è‡ªå¸¦åç«¯<br>  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>  åŠŸèƒ½: TODO é¡µé¢<br>  è®¤è¯æ–¹å¼: Device Flow + Cloudflare Worker<br>  åŸå› : è‡ªå»ºåŠŸèƒ½ï¼Œçº¯é™æ€ç«™æ— åç«¯<br>  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>  åŠŸèƒ½: åˆ’è¯è¯„è®º<br>  è®¤è¯æ–¹å¼: Device Flow + Cloudflare Worker<br>  åŸå› : åŒä¸Šï¼Œå¤ç”¨ç›¸åŒçš„ Worker<br>  æ ¸å¿ƒåŒºåˆ«åœ¨äºï¼šæœ‰æ²¡æœ‰åç«¯æ¥å®‰å…¨åœ°æŒæœ‰ client_secretã€‚Utterances<br>  è‡ªå¸¦åç«¯æ‰€ä»¥é€æ˜å¤„ç†äº†ï¼Œè€Œè‡ªå»ºåŠŸèƒ½åªèƒ½å€ŸåŠ© Cloudflare Worker<br>  å……å½“è½»é‡åç«¯ï¼Œé…åˆä¸éœ€è¦ secret çš„ Device Flowã€‚</p>
<blockquote>
<p>é‚£è‡ªå»ºçš„cloudflare workeræŒæœ‰client_secretå®‰å…¨å— </p>
</blockquote>
<p>â— å®‰å…¨çš„ï¼Œè¿™æ˜¯ä¸šç•Œæ ‡å‡†åšæ³•ã€‚æœ¬è´¨ä¸Š Cloudflare Worker å°±æ˜¯å……å½“äº†ä¸€ä¸ªè½»é‡åç«¯ã€‚</p>
<p>  ä¸ºä»€ä¹ˆå®‰å…¨</p>
<p>  Client Secret å­˜å‚¨åœ¨ Worker çš„ç¯å¢ƒå˜é‡ä¸­ï¼Œä¸ä¼šå‡ºç°åœ¨ï¼š</p>
<ul>
<li>å‰ç«¯ä»£ç ä¸­</li>
<li>Git ä»“åº“ä¸­</li>
<li>ç½‘ç»œè¯·æ±‚çš„å“åº”ä¸­</li>
<li>æµè§ˆå™¨å¯è®¿é—®çš„ä»»ä½•åœ°æ–¹</li>
</ul>
<p>  ç”¨æˆ·æµè§ˆå™¨åªå’Œ Worker é€šä¿¡ï¼ŒWorker å†å¸¦ä¸Š secret å»è°ƒ GitHub APIï¼Œæ•´ä¸ªè¿‡ç¨‹<br>  secret åªåœ¨ Worker è¿è¡Œæ—¶çš„æœåŠ¡ç«¯å†…å­˜ä¸­å­˜åœ¨ï¼š</p>
<p>  æµè§ˆå™¨ â”€â”€(device_code)â”€â”€â†’ Cloudflare Worker â”€â”€(device_code + client_secret)â”€â”€â†’<br>   GitHub API<br>  æµè§ˆå™¨ â†â”€â”€(access_token)â”€â”€ Cloudflare Worker â†â”€â”€(access_token)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>   GitHub API</p>
<p>  å’Œä¼ ç»Ÿåç«¯çš„å¯¹æ¯”<br>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>  â”‚              â”‚  ä¼ ç»Ÿåç«¯ (Node/Python)   â”‚      Cloudflare Worker      â”‚<br>  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>  â”‚ Secret å­˜å‚¨  â”‚ ç¯å¢ƒå˜é‡ / Secret Manager â”‚ ç¯å¢ƒå˜é‡ (Wrangler Secrets) â”‚<br>  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>  â”‚ è¿è¡Œç¯å¢ƒ     â”‚ ä½ è‡ªå·±çš„æœåŠ¡å™¨            â”‚ Cloudflare è¾¹ç¼˜èŠ‚ç‚¹         â”‚<br>  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>  â”‚ å¯è¢«åç¼–è¯‘ï¼Ÿ â”‚ ä¸èƒ½ï¼ˆæœåŠ¡ç«¯ä»£ç ï¼‰        â”‚ ä¸èƒ½ï¼ˆæœåŠ¡ç«¯ä»£ç ï¼‰          â”‚<br>  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>  â”‚ å®‰å…¨ç­‰çº§     â”‚ ç›¸åŒ                      â”‚ ç›¸åŒ                        â”‚<br>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>  ä¸¤è€…åœ¨å®‰å…¨æ¨¡å‹ä¸Šæ²¡æœ‰åŒºåˆ«ï¼ŒWorker ä»£ç è¿è¡Œåœ¨ Cloudflare<br>  çš„æœåŠ¡ç«¯ï¼Œå’Œä¼ ç»Ÿåç«¯ä¸€æ ·ä¸å¯è¢«å®¢æˆ·ç«¯è®¿é—®ã€‚</p>
<p>  éœ€è¦æ³¨æ„çš„ç‚¹</p>
<p>  å”¯ä¸€éœ€è¦å…³æ³¨çš„æ˜¯ Worker æœ¬èº«çš„æ¥å£è®¾è®¡ï¼Œç¡®ä¿å®ƒä¸ä¼šæŠŠ secret æ³„éœ²å‡ºå»ï¼š</p>
<ul>
<li>Worker ä¸åº”åœ¨å“åº”ä¸­è¿”å› secret</li>
<li>åº”è¯¥é™åˆ¶ CORSï¼ˆåªå…è®¸ä½ è‡ªå·±çš„åŸŸåè°ƒç”¨ï¼‰</li>
<li>åªä»£ç†å¿…è¦çš„ GitHub OAuth ç«¯ç‚¹ï¼Œä¸åšé€šç”¨ä»£ç†</li>
</ul>
<p>  å¦‚æœä½ æƒ³ç¡®è®¤ä¸€ä¸‹ä½ çš„ Worker å®ç°ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹å®ƒçš„æºç æ˜¯å¦ç¬¦åˆè¿™äº›åŸåˆ™ã€‚</p>
<blockquote>
<p>é‚£workeræ€ä¹ˆéªŒè¯æˆ‘çš„èº«ä»½å‘¢ï¼Ÿæ˜¯å¦æ‰€æœ‰èƒ½è®¿é—®æˆ‘workerçš„äººéƒ½èƒ½æ‹¿åˆ°æˆ‘èº«ä»½ </p>
</blockquote>
<p>â— å¥½é—®é¢˜ã€‚ç®€çŸ­å›ç­”ï¼šåˆ«äººè°ƒä½ çš„ Worker æ‹¿ä¸åˆ°ä½ çš„èº«ä»½ï¼Œä½†æœ‰å…¶ä»–é£é™©å€¼å¾—å…³æ³¨ã€‚</p>
<p>  Worker ä¸æŒæœ‰ä½ çš„èº«ä»½</p>
<p>  Worker é‡Œåªæœ‰ client_secretï¼ˆOAuth App çš„å¯†é’¥ï¼‰ï¼Œä¸æ˜¯ä½ çš„ä¸ªäºº<br>  tokenã€‚æ•´ä¸ªæµç¨‹ä¸­ï¼Œtoken çš„è·å–å¿…é¡»ç»è¿‡ç”¨æˆ·æœ¬äººåœ¨ GitHub ä¸Šçš„æ˜¾å¼æˆæƒï¼š</p>
<p>  æ”»å‡»è€…è°ƒç”¨ Worker /device/code â†’ æ‹¿åˆ°ä¸€ä¸ª device code<br>                                      â†“<br>                           å¿…é¡»æœ‰äººå» GitHub æ‰‹åŠ¨è¾“å…¥è¿™ä¸ª code å¹¶ç‚¹å‡»æˆæƒ<br>                                      â†“<br>                           token å±äºç‚¹å‡»æˆæƒçš„é‚£ä¸ªäººï¼Œä¸æ˜¯ä½ </p>
<p>  æ²¡æœ‰ä»»ä½•äººåœ¨ GitHub ä¸Šç‚¹æˆæƒï¼Œè¿™ä¸ª device code å°±ä¼šè¿‡æœŸä½œåºŸã€‚Worker<br>  è‡ªå§‹è‡³ç»ˆä¸æŒæœ‰ã€ä¹Ÿä¸ä¼šè¿”å›ä»»ä½•äººçš„ä¸ªäºº tokenã€‚</p>
<p>  çœŸæ­£çš„é£é™©</p>
<p>  é£é™©ä¸åœ¨äº"å·ä½ èº«ä»½"ï¼Œè€Œåœ¨äº æ»¥ç”¨ä½ çš„ OAuth Appï¼š<br>  é£é™©: é’“é±¼<br>  è¯´æ˜: æ”»å‡»è€…ç”¨ä½ çš„ Worker å‘èµ·æˆæƒï¼Œç”¨æˆ·åœ¨ GitHub æˆæƒé¡µçœ‹åˆ°çš„æ˜¯ä½ çš„ App<br>    åå­—ï¼Œå¯èƒ½è¯¯ä»¥ä¸ºæ˜¯ä½ çš„ç½‘ç«™åœ¨è¯·æ±‚ï¼Œä»è€Œæˆæƒã€‚æ”»å‡»è€…æ‹¿åˆ°çš„æ˜¯å—å®³è€…è‡ªå·±çš„<br>    token<br>  ä¸¥é‡ç¨‹åº¦: ä¸­<br>  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>  é£é™©: åˆ·é‡<br>  è¯´æ˜: å¤§é‡è¯·æ±‚ /device/codeï¼Œè€—å°½ GitHub API çš„é€Ÿç‡é™åˆ¶<br>  ä¸¥é‡ç¨‹åº¦: ä½<br>  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>  é£é™©: App è¢«å°<br>  è¯´æ˜: å¦‚æœè¢«æ»¥ç”¨ï¼ŒGitHub å¯èƒ½ç¦ç”¨ä½ çš„ OAuth App<br>  ä¸¥é‡ç¨‹åº¦: ä¸­<br>  å»ºè®®åŠ å›ºæªæ–½</p>
<ol>
<li>CORS é™åˆ¶ï¼ˆæœ€é‡è¦ï¼‰ â€” åªå…è®¸ä½ è‡ªå·±çš„åŸŸåè°ƒç”¨ Workerï¼š</li>
</ol>
<p>  // Worker ä¸­<br>  const ALLOWED_ORIGINS = ['<a href="https://shinerio.site'%5D">https://shinerio.site&#39;]</a>;</p>
<p>  if (!ALLOWED_ORIGINS.includes(request.headers.get('Origin'))) {<br>    return new Response('Forbidden', { status: 403 });<br>  }</p>
<p>  è¿™æ ·æµè§ˆå™¨ç«¯åªæœ‰ä½ çš„ç½‘ç«™èƒ½è°ƒç”¨ï¼Œå…¶ä»–åŸŸåçš„è¯·æ±‚ä¼šè¢«æ‹’ç»ã€‚</p>
<ol start="2">
<li>Referer æ£€æŸ¥ â€” åŒé‡éªŒè¯æ¥æºï¼š</li>
</ol>
<p>  const referer = request.headers.get('Referer') || '';<br>  if (!referer.startsWith('<a href="https://shinerio.site">https://shinerio.site</a>')) {<br>    return new Response('Forbidden', { status: 403 });<br>  }</p>
<ol start="3">
<li>é€Ÿç‡é™åˆ¶ â€” Cloudflare Workers æ”¯æŒ Rate Limitingï¼Œé˜²æ­¢åˆ·é‡ã€‚</li>
</ol>
<p>  æ³¨æ„ï¼šCORS åªèƒ½é˜²æµè§ˆå™¨ç«¯çš„è·¨åŸŸè°ƒç”¨ã€‚æ”»å‡»è€…ç”¨ curl ç­‰å·¥å…·ä»å¯ç›´æ¥è¯·æ±‚<br>  Workerï¼Œä½†è¿™ç§æƒ…å†µä¸‹æ‹¿åˆ° device code ä¹Ÿæ²¡ä»€ä¹ˆç”¨â€”â€”è¿˜æ˜¯éœ€è¦ç”¨æˆ·è‡ªå·±å» GitHub<br>  æˆæƒæ‰èƒ½è·å¾— tokenã€‚æ‰€ä»¥å®é™…é£é™©å¾ˆä½ï¼ŒåŠ ä¸Š CORS å°±å·²ç»è¶³å¤Ÿäº†ã€‚</p>
<p>âœ» Worked for 31s</p>

    </section>
</article>


<section class="comments-section" id="comments">
    <h2 class="comments-title">è¯„è®º</h2>
    <div class="utterances-container">
        <script src="https://utteranc.es/client.js"
        repo="shinerio/shinerio.github.io"
        issue-term="Github Oauth"
        label="blog-comment"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>
    </div>
</section>
            </div>
        </main>
        <footer class="page-footer">
            <div class="container">
                <p>&copy; 2026 shinerio. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script>
        // Theme switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('theme-toggle');
            const body = document.getElementById('theme-body');

            // Check for saved theme preference or respect OS preference
            const savedTheme = localStorage.getItem('theme');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');

            // Set initial theme
            if (savedTheme === 'dark' || (!savedTheme && prefersDarkScheme.matches)) {
                body.setAttribute('data-theme', 'dark');
            } else {
                body.removeAttribute('data-theme'); // light theme
            }

            // Sync Utterances iframe theme
            function syncUtterancesTheme(isDark) {
                const utterancesFrame = document.querySelector('.utterances-frame');
                if (utterancesFrame) {
                    const theme = isDark ? 'github-dark' : 'github-light';
                    utterancesFrame.contentWindow.postMessage(
                        { type: 'set-theme', theme: theme },
                        'https://utteranc.es'
                    );
                }
            }

            // Listen for Utterances iframe ready to set initial theme
            window.addEventListener('message', function(event) {
                if (event.origin !== 'https://utteranc.es') return;
                const isDark = body.getAttribute('data-theme') === 'dark' ||
                    (!localStorage.getItem('theme') && prefersDarkScheme.matches);
                syncUtterancesTheme(isDark);
            });

            // Toggle theme function
            function toggleTheme() {
                if (body.getAttribute('data-theme') === 'dark') {
                    body.removeAttribute('data-theme');
                    localStorage.setItem('theme', 'light');
                    syncUtterancesTheme(false);
                } else {
                    body.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                    syncUtterancesTheme(true);
                }
            }

            // Add event listener to theme toggle button
            themeToggle.addEventListener('click', toggleTheme);

            // Listen for OS theme changes
            prefersDarkScheme.addEventListener('change', function(e) {
                if (!localStorage.getItem('theme')) {
                    if (e.matches) {
                        body.setAttribute('data-theme', 'dark');
                    } else {
                        body.removeAttribute('data-theme');
                    }
                    syncUtterancesTheme(e.matches);
                }
            });

            // Sidebar toggle (desktop + mobile)
            const sidebarToggle = document.querySelector('.sidebar-toggle');
            const sidebar = document.querySelector('.sidebar');
            const sidebarOverlay = document.querySelector('.sidebar-overlay');

            if (sidebarToggle && sidebar) {
                // Helper function to detect mobile
                const isMobile = () => window.innerWidth < 768;

                // Function to handle sidebar opening
                const openSidebar = () => {
                    sidebar.classList.add('active');
                    if (sidebarOverlay) {
                        sidebarOverlay.classList.add('active');
                        // Ensure overlay doesn't block page interaction when closed
                        sidebarOverlay.style.pointerEvents = 'auto';
                    }
                };

                // Function to handle sidebar closing
                const closeSidebar = () => {
                    sidebar.classList.remove('active');
                    if (sidebarOverlay) {
                        sidebarOverlay.classList.remove('active');
                        // Remove overlay when not needed to avoid blocking page
                        sidebarOverlay.style.pointerEvents = 'none';
                    }
                };

                // Restore saved collapse state for desktop
                if (!isMobile() && localStorage.getItem('sidebar-collapsed') === 'true') {
                    document.body.classList.add('sidebar-collapsed');
                }

                sidebarToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    if (isMobile()) {
                        // Mobile: overlay drawer behavior
                        if (sidebar.classList.contains('active')) {
                            closeSidebar();
                        } else {
                            openSidebar();
                        }
                    } else {
                        // Desktop: collapse/expand with body offset
                        document.body.classList.toggle('sidebar-collapsed');
                        localStorage.setItem('sidebar-collapsed',
                            document.body.classList.contains('sidebar-collapsed'));
                    }
                });

                // Close sidebar when clicking on overlay
                if (sidebarOverlay) {
                    sidebarOverlay.addEventListener('click', function(e) {
                        e.preventDefault();
                        closeSidebar();
                    });

                    // Prevent scroll on overlay
                    sidebarOverlay.addEventListener('touchmove', function(e) {
                        e.preventDefault();
                    }, { passive: false });
                }

                // Handle resize events to ensure proper behavior when switching between mobile/desktop
                let resizeTimeout;
                window.addEventListener('resize', function() {
                    // Clear any existing timeout
                    clearTimeout(resizeTimeout);

                    // Use timeout to handle resize efficiently
                    resizeTimeout = setTimeout(() => {
                        if (!isMobile()) {
                            // On desktop view, ensure mobile classes are removed
                            sidebar.classList.remove('active');
                            if (sidebarOverlay) {
                                sidebarOverlay.classList.remove('active');
                                sidebarOverlay.style.pointerEvents = 'none';
                            }
                        }
                    }, 100);
                });

                // Close sidebar on orientation change (important for mobile Safari)
                window.addEventListener('orientationchange', function() {
                    setTimeout(() => {
                        if (!isMobile()) {
                            sidebar.classList.remove('active');
                            if (sidebarOverlay) {
                                sidebarOverlay.classList.remove('active');
                                sidebarOverlay.style.pointerEvents = 'none';
                            }
                        }
                    }, 100);
                });

                // Close sidebar when clicking anywhere outside of it (on mobile)
                document.addEventListener('click', function(e) {
                    // Only handle outside clicks on mobile when sidebar is active
                    if (isMobile() &&
                        sidebar.classList.contains('active') &&
                        !sidebar.contains(e.target) &&
                        e.target !== sidebarToggle) {
                        closeSidebar();
                    }
                });
            }

            // Search functionality
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const searchResults = document.getElementById('search-results');
            const searchSuggestions = document.getElementById('search-suggestions');
            const searchTypeRadios = document.querySelectorAll('input[name="search-type"]');

            if (searchInput && searchButton) {
                let searchData = null;

                // Load search data
                async function loadSearchData() {
                    try {
                        const response = await fetch('./assets/js/search-data.json');
                        if (response.ok) {
                            searchData = await response.json();
                        } else {
                            console.error('Failed to load search data:', response.status);
                        }
                    } catch (error) {
                        console.error('Error loading search data:', error);
                    }
                }

                // Initialize search data
                loadSearchData();

                // Debounce function to limit search calls
                function debounce(func, wait) {
                    let timeout;
                    return function executedFunction(...args) {
                        const later = () => {
                            clearTimeout(timeout);
                            func(...args);
                        };
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                    };
                }

                // Get selected search type
                function getSelectedSearchType() {
                    const selectedRadio = document.querySelector('input[name="search-type"]:checked');
                    return selectedRadio ? selectedRadio.value : 'all';
                }

                // Perform search
                function performSearch(query) {
                    if (!searchData || !query.trim()) {
                        searchResults.innerHTML = '';
                        searchSuggestions.innerHTML = '';
                        return;
                    }

                    const queryTerms = query.toLowerCase().split(/\s+/).filter(term => term.length > 0);
                    const searchType = getSelectedSearchType();

                    if (queryTerms.length === 0) {
                        searchResults.innerHTML = '';
                        return;
                    }

                    const results = [];

                    // Search through articles
                    searchData.articles.forEach(article => {
                        let score = 0;
                        let snippet = '';

                        // Get content based on search type
                        const lowerTitle = article.title.toLowerCase();
                        const lowerContent = article.content.toLowerCase();
                        const lowerTags = article.tags.join(' ').toLowerCase();

                        queryTerms.forEach(term => {
                            switch(searchType) {
                                case 'title':
                                    // Only title matches count
                                    if (lowerTitle.includes(term)) {
                                        score += 10;
                                    }
                                    break;
                                case 'content':
                                    // Only content matches count (fixed to exclude title matches)
                                    if (lowerContent.includes(term)) {
                                        score += 1;
                                    }
                                    break;
                                case 'all':
                                default:
                                    // Both title and content matches count
                                    if (lowerTitle.includes(term)) {
                                        score += 10;
                                    }
                                    if (lowerContent.includes(term)) {
                                        score += 1;
                                    }
                                    // Tag matches get medium-high score
                                    if (lowerTags.includes(term)) {
                                        score += 5;
                                    }
                                    break;
                            }
                        });

                        if (score > 0) {
                            // Generate snippet based on search type
                            let content = '';

                            if (searchType === 'title') {
                                // For title-only search, show title content
                                content = article.title.substring(0, 200);
                            } else if (searchType === 'content') {
                                // For content-only search, show content excerpt
                                content = article.content.substring(0, 200);
                            } else {
                                // For all search, show content with title as context
                                content = article.content.substring(0, 200);
                            }

                            // Find first occurrence of query term in content for snippet
                            queryTerms.forEach(term => {
                                let searchIn = content.toLowerCase();
                                if (searchType === 'title') {
                                    searchIn = lowerTitle;
                                } else if (searchType === 'content') {
                                    searchIn = lowerContent;
                                }

                                const index = searchIn.indexOf(term);
                                if (index !== -1) {
                                    // Expand snippet around the match
                                    let start, end;
                                    if (searchType === 'title') {
                                        start = Math.max(0, index - 15);
                                        end = Math.min(content.length, index + term.length + 35);
                                    } else {
                                        start = Math.max(0, index - 30);
                                        end = Math.min(content.length, index + term.length + 70);
                                    }

                                    content = (start > 0 ? '...' : '') +
                                              content.substring(start, end) +
                                              (end < (searchType === 'title' ? article.title.length : article.content.length) ? '...' : '');

                                    // Highlight the term in the snippet
                                    const searchContent = searchType === 'title' ? article.title : article.content;
                                    const adjustedIndex = searchType === 'title' ?
                                        Math.min(index, article.title.length - 1) :
                                        Math.min(index, article.content.length - 1);

                                    content = content.replace(
                                        new RegExp(`(${escapeRegExp(term)})`, 'gi'),
                                        '<mark>$1</mark>'
                                    );
                                }
                            });

                            results.push({
                                article: article,
                                score: score,
                                snippet: content
                            });
                        }
                    });

                    // Sort results by score
                    results.sort((a, b) => b.score - a.score);

                    // Display results
                    displaySearchResults(results);
                }

                // Display search results
                function displaySearchResults(results) {
                    if (results.length === 0) {
                        searchResults.innerHTML = '<p class="no-results">æœªæ‰¾åˆ°åŒ¹é…çš„æ–‡ç« </p>';
                        return;
                    }

                    const resultsHTML = results.map(result => `
                        <div class="search-result-item">
                            <h3 class="search-result-title">
                                <a href="./${result.article.slug}.html">${highlightQueryTerms(result.article.title, document.querySelector('#search-input').value)}</a>
                            </h3>
                            <div class="search-result-meta">
                                ${result.article.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                            </div>
                            <p class="search-result-excerpt">${result.snippet}</p>
                        </div>
                    `).join('');

                    searchResults.innerHTML = resultsHTML;
                }

                // Highlight query terms in text
                function highlightQueryTerms(text, query) {
                    if (!query.trim()) return text;

                    const queryTerms = query.split(/\s+/).filter(term => term.length > 0);
                    let highlightedText = text;

                    queryTerms.forEach(term => {
                        const regex = new RegExp(`(${escapeRegExp(term)})`, 'gi');
                        highlightedText = highlightedText.replace(regex, '<mark>$1</mark>');
                    });

                    return highlightedText;
                }

                // Escape special regex characters
                function escapeRegExp(string) {
                    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                }

                // Event listener for search button
                searchButton.addEventListener('click', function() {
                    const query = searchInput.value;
                    performSearch(query);
                });

                // Event listener for Enter key
                searchInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        const query = searchInput.value;
                        performSearch(query);
                    }
                });

                // Add debounced input handler for live search (optional)
                const debouncedSearch = debounce(function() {
                    const query = searchInput.value;
                    performSearch(query);
                }, 300);

                searchInput.addEventListener('input', debouncedSearch);

                // Add event listeners for search type radios
                searchTypeRadios.forEach(radio => {
                    radio.addEventListener('change', function() {
                        const query = searchInput.value;
                        if (query.trim()) {
                            performSearch(query);
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>